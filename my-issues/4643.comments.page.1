[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541226","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541226","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541226,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIyNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-03-22T20:40:53Z","updated_at":"2017-10-18T10:21:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 685\n`make src/Parsers/Refinement/SharpenedJSON.vo`\n\nIn the attached code (same as bug [BZ#4642](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%234642%22)), in Coq 8.4, in src/Parsers/Refinement/SharpenedJSON.v, the first [Defined] takes about 2 minutes, which seems rather unfortunate.\n\n> Attached file: [bug_4643.zip](https://coq.inria.fr/bugfiles/attachment.cgi?id=685) (application/x-zip-compressed, 953061 bytes)\n> Description:   `make src/Parsers/Refinement/SharpenedJSON.vo`\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541228","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541228","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541228,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIyOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T14:20:41Z","updated_at":"2017-10-18T10:21:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 693\n`make src/Parsers/Refinement/SharpenedJSON.vo`\n\n> Attached file: [bug_4643.zip](https://coq.inria.fr/bugfiles/attachment.cgi?id=693) (application/x-zip-compressed, 999072 bytes)\n> Description:   `make src/Parsers/Refinement/SharpenedJSON.vo`\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541231","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541231","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541231,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzMQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T18:54:44Z","updated_at":"2017-10-18T10:21:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI believe you're going to be a happy user of native_compute in 8.5. It seems that Coq is passing virtually all of its time in term reduction by the VM. If your tactics are not badly designed (e.g. recomputing several times the same result), I'm pretty much convinced that there is no solution. And thus, no problem.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541232","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541232","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541232,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-06-04T01:07:36Z","updated_at":"2017-10-18T10:21:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 716\nSlow Defined in src/Parsers/Refinement/SharpenedJSON{,Native}.v\n\n> I believe you're going to be a happy user of native_compute in 8.5\n\nI disagree.  When I use [native_compute], the [Defined] takes 818.476 s of user time rather than 94 s of user time.  Furthermore, there doesn't seem to be any easy way to specify that some files should get native code and others should not, and trying to compile the definition to native code (when I use vm_compute) blows through 64 GB of RAM.  (Alas, the proof is large and transparent, because [abstract] does not handle evars, and it's built up in parts.  I could possibly make it a [Let] rather than a [Definition], but that might cause issues with ending the section, which already takes 15-30 seconds)  Also, unless I'm doing something wrong, native_compute isn't any faster than vm_compute on my proof script (though I may very well be doing something wrong).\n\nWith vm_compute:\n/usr/bin/time -f \"src/Parsers/Refinement/SharpenedJSON (user: %U mem: %M ko)\" \"/home/jgross/.local64/coq/coq-8.5pl1/bin/coqc\"  -q  -R \"src\" Fiat -compat 8.4 -native-compiler  src/Parsers/Refinement/SharpenedJSON\nFinished transaction in 0. secs (0.u,0.s) (successful)\nFinished transaction in 4.869 secs (4.864u,0.007s) (successful)\nFinished transaction in 1.958 secs (1.956u,0.s) (successful)\nFinished transaction in 115.912 secs (115.904u,0.004s) (successful)\nFinished transaction in 674.238 secs (674.144u,0.059s) (successful)\nFinished transaction in 39.47 secs (39.452u,0.016s) (successful)\nFinished transaction in 136.335 secs (136.312u,0.015s) (successful)\nFinished transaction in 41.486 secs (41.48u,0.004s) (successful)\nFinished transaction in 9.158 secs (9.159u,0.s) (successful)\nFinished transaction in 0.506 secs (0.504u,0.s) (successful)\nFinished transaction in 94.265 secs (94.207u,0.052s) (successful) <--- Defined.\nFinished transaction in 5.394 secs (5.039u,0.352s) (successful)\nFinished transaction in 0.055 secs (0.051u,0.s) (successful)\nFinished transaction in 17.007 secs (15.072u,1.936s) (successful)  <---- End IndexedImpl.\nFatal error: out of memory.\nError: Could not compile the library to native code.\nCommand exited with non-zero status 1\nsrc/Parsers/Refinement/SharpenedJSON (user: 1197.02 mem: 6388704 ko)\n\nWith native_compute:\n/usr/bin/time -f \"src/Parsers/Refinement/SharpenedJSONNative (user: %U mem: %M ko)\" \"/home/jgross/.local64/coq/coq-8.5pl1/bin/coqc\"  -q  -R \"src\" Fiat -compat 8.4 -native-compiler  src/Parsers/Refinement/SharpenedJSONNative\nFinished transaction in 0. secs (0.u,0.s) (successful)\nFinished transaction in 5.056 secs (4.864u,0.035s) (successful)\nFinished transaction in 1.982 secs (1.976u,0.008s) (successful)\nFinished transaction in 115.609 secs (115.556u,0.043s) (successful)\nFinished transaction in 608.772 secs (601.812u,1.636s) (successful)\nFinished transaction in 35.037 secs (34.543u,0.104s) (successful)\nFinished transaction in 122.969 secs (122.764u,0.076s) (successful)\nFinished transaction in 41.725 secs (41.716u,0.008s) (successful)\nFinished transaction in 9.226 secs (9.223u,0.s) (successful)\nFinished transaction in 0.503 secs (0.504u,0.s) (successful)\nFinished transaction in 1037.209 secs (818.476u,1.396s) (successful) <--- Defined.\nFinished transaction in 5.083 secs (5.028u,0.056s) (successful)\nFinished transaction in 0.054 secs (0.052u,0.s) (successful)\nFinished transaction in 14.39 secs (14.283u,0.108s) (successful)  <---- End IndexedImpl.\n^Cmake: *** Deleting file `src/Parsers/Refinement/SharpenedJSONNative.vo'\nCommand terminated by signal 2\nsrc/Parsers/Refinement/SharpenedJSONNative (user: 1851.12 mem: 5288316 ko)\nmake: *** [src/Parsers/Refinement/SharpenedJSONNative.vo] Interrupt\n\n(I killed the second one rather than let it thrash my machine.  The extra 200 s of non-user time in the second comes from when the first one was thrashing my machine; I had them running in parallel on a machine with 6 physical cores and 64 GB of RAM, and the vm_compute one died at the end of the file before the native_compute one managed to finish [Defined], even though I started them at the same time.)\n\nSee README.md for more information in the attached archive, which should build with both 8.5pl1 (with -compat 8.4) and with 8.4pl{2,3,4,5,6}.\n\n> Attached file: [slow_defined.zip](https://coq.inria.fr/bugfiles/attachment.cgi?id=716) (application/zip, 420812 bytes)\n> Description:   Slow Defined in src/Parsers/Refinement/SharpenedJSON{,Native}.v\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541235","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541235","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541235,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T01:38:54Z","updated_at":"2017-10-18T10:21:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nAll right, this one took me a long time, but I think I nailed it.\n\n« TL;DR: programming in Coq does prevent you from using proper algorithms. »\n\nYou have a hell of a lot of very inefficient computations due to the way you code the sequences of ASCII characters. In particular, the 'code_in_range' notation relies on 'opt.nat_of_ascii' which is terrible w.r.t. efficiency. You should rather use binpos integers.\n\nIf the night is not too short, I may come up with a PR for your code to prove my point and hopefully close this bug report with a well-deserved INVALID qualifier!\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541236","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541236","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541236,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T01:40:22Z","updated_at":"2017-10-18T10:21:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nBTW, if you wonder how I found this out: I simply perfed the Coq process while using the native_compute variant, and witnessed the actual costly backtrace. All hail to normalization by evaluation in your host language!\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541238","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541238","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541238,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T02:24:49Z","updated_at":"2017-10-18T10:21:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nWith a one-line change:\n\n-Notation code_le ch ch' := (Compare_dec.leb (opt.nat_of_ascii ch) (opt.nat_of_ascii ch')).\n+Notation code_le ch ch' := (BinNat.N.leb (N_of_ascii ch) (N_of_ascii ch')).\n\nI get the following results in 8.6 + refold patch / native_compute:\n\nFinished transaction in 0. secs (0.u,0.s) (successful)\nFinished transaction in 3.392 secs (3.024u,0.144s) (successful)\nFinished transaction in 0.858 secs (0.819u,0.039s) (successful)\nFinished transaction in 20.449 secs (20.416u,0.016s) (successful)\nFinished transaction in 176.435 secs (158.56u,6.868s) (successful)\nFinished transaction in 12.081 secs (10.635u,0.575s) (successful)\nFinished transaction in 27.275 secs (26.539u,0.383s) (successful)\nFinished transaction in 24.793 secs (24.716u,0.04s) (successful)\nFinished transaction in 4.173 secs (4.164u,0.007s) (successful)\nFinished transaction in 0.067 secs (0.063u,0.s) (successful)\n(* Defined takes more time than I want to spend *)\n\nI had timings similar to you before the patch, so in particular, it means that the duration of the 5th instance has been divided by about 4 for the tactic calls.\n\nThe Defined command still takes ages, but now the perf tool is hinting me at the Gensym function in this case... What do you think?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541239","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541239","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541239,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTIzOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T15:59:38Z","updated_at":"2017-10-18T10:21:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nOooh, thanks!  It'd be nice if there were some way to get this profiling data from inside of Coq, e.g., a [Set Native Profiling] and [Print Native Profile].  Any chance of that happening?\n\nRe gensym: ugh, really?  I use gensym to generate an \"invalid string label\" by, basically, concatenating all of the string labels together, sticking an \"a\" before each one.  I need an invalid label so that when I convert back and forth between numbers and labels, I can handle invalid numbers; I need my resulting code that I extract to use [int] and not [int option].  It should only ever be called with a single argument (at the top-level), and it should be possible to pre-compute it, but then it might be the case that we'll have a ~1000 character string showing up in a bunch of places in the code/proof.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541239/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541241","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541241","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541241,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTI0MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T16:17:05Z","updated_at":"2017-10-18T10:21:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n(In reply to Jason Gross from comment [BZ#7](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%237%22))\n> Oooh, thanks!  It'd be nice if there were some way to get this profiling\n> data from inside of Coq, e.g., a [Set Native Profiling] and [Print Native\n> Profile].  Any chance of that happening?\n\nI don't think so. This relies on OS-specific features.\n\n> Re gensym: ugh, really?  I use gensym to generate an \"invalid string label\"\n> by, basically, concatenating all of the string labels together, sticking an\n> \"a\" before each one.  I need an invalid label so that when I convert back\n> and forth between numbers and labels, I can handle invalid numbers; I need\n> my resulting code that I extract to use [int] and not [int option].  It\n> should only ever be called with a single argument (at the top-level), and it\n> should be possible to pre-compute it, but then it might be the case that\n> we'll have a ~1000 character string showing up in a bunch of places in the\n> code/proof.\n\nI'm not sure about it though. You should probably double-check your code and take asymptotic issues in consideration.\n\nOn an unrelated note, rather than using N + native_compute, you may try to use Int31 + vm_compute. The VM uses retroknowledge, so that Int31 are actually compiled to machine integers, which may speed up your usecase a lot. Or not, but it may be worth the try.\n\nI'm not closing this bug yet because it's unclear whether what is taking ages in the Defined computation is due to your code or is some bug in Coq. I'll investigate a bit more.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541243","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541243","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541243,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTI0Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T16:58:50Z","updated_at":"2017-10-18T10:21:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThe native_compute version seems to recompile code a lot of times, leading to a very bad overall complexity. I'm not sure whether this is a bug or a limitation of its architecture, but I'm now pretty much convinced that the current bug is invalid at least in its original form (i.e. using vm_compute and disabling native compilation).\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541246","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541246","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541246,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTI0Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T23:41:39Z","updated_at":"2017-10-18T10:21:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @maximedenes\n\n(In reply to Pierre-Marie Pédrot from comment [BZ#8](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%238%22))\n> (In reply to Jason Gross from comment [BZ#7](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%237%22))\n> > Oooh, thanks!  It'd be nice if there were some way to get this profiling\n> > data from inside of Coq, e.g., a [Set Native Profiling] and [Print Native\n> > Profile].  Any chance of that happening?\n> \n> I don't think so. This relies on OS-specific features.\n> \n> > Re gensym: ugh, really?  I use gensym to generate an \"invalid string label\"\n> > by, basically, concatenating all of the string labels together, sticking an\n> > \"a\" before each one.  I need an invalid label so that when I convert back\n> > and forth between numbers and labels, I can handle invalid numbers; I need\n> > my resulting code that I extract to use [int] and not [int option].  It\n> > should only ever be called with a single argument (at the top-level), and it\n> > should be possible to pre-compute it, but then it might be the case that\n> > we'll have a ~1000 character string showing up in a bunch of places in the\n> > code/proof.\n> \n> I'm not sure about it though. You should probably double-check your code and\n> take asymptotic issues in consideration.\n> \n> On an unrelated note, rather than using N + native_compute, you may try to\n> use Int31 + vm_compute. The VM uses retroknowledge, so that Int31 are\n> actually compiled to machine integers, which may speed up your usecase a\n> lot. Or not, but it may be worth the try.\n> \n> I'm not closing this bug yet because it's unclear whether what is taking\n> ages in the Defined computation is due to your code or is some bug in Coq.\n> I'll investigate a bit more.\n\nNote that native_compute also takes advantage of retroknowledge, so using int31 + native_compute makes sense. I even have an old branch of Coq with 63-bits integers which speeds up things very significantly when doing a lot of arithmetic.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541248","html_url":"https://github.com/coq/coq/issues/4643#issuecomment-337541248","issue_url":"https://api.github.com/repos/coq/coq/issues/4643","id":337541248,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTI0OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-08-20T23:42:35Z","updated_at":"2017-10-18T10:21:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @maximedenes\n\n(In reply to Pierre-Marie Pédrot from comment [BZ#9](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%239%22))\n> The native_compute version seems to recompile code a lot of times, leading\n> to a very bad overall complexity. I'm not sure whether this is a bug or a\n> limitation of its architecture, but I'm now pretty much convinced that the\n> current bug is invalid at least in its original form (i.e. using vm_compute\n> and disabling native compilation).\n\nI'll try to have a look at the example to see if it is a native_compute bug ASAP, but we're attending ITP next week.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]