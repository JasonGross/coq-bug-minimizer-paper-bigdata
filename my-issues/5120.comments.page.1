[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547861","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547861","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547861,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T20:40:24Z","updated_at":"2017-12-07T07:16:51Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nEvaluate this to the end in PG, and then spam C-c in the middle of it\r\n```coq\r\nRequire Coq.ZArith.BinInt Coq.Lists.List.\r\nDefinition foo0 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo0.\r\nDefinition foo1 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo1.\r\nDefinition foo2 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo2.\r\nDefinition foo3 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo3.\r\nDefinition foo4 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo4.\r\nDefinition foo5 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo5.\r\nDefinition foo6 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo6.\r\nDefinition foo7 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo7.\r\nDefinition foo8 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo8.\r\nDefinition foo9 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo9.\r\nDefinition foo10 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo10.\r\nDefinition foo11 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo11.\r\nDefinition foo12 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo12.\r\nDefinition foo13 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo13.\r\nDefinition foo14 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo14.\r\nDefinition foo15 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo15.\r\nDefinition foo16 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo16.\r\nDefinition foo17 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo17.\r\nDefinition foo18 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo18.\r\nDefinition foo19 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo19.\r\nDefinition foo20 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo20.\r\nDefinition foo21 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo21.\r\nDefinition foo22 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo22.\r\nDefinition foo23 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo23.\r\nDefinition foo24 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo24.\r\nDefinition foo25 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo25.\r\nDefinition foo26 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo26.\r\nDefinition foo27 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo27.\r\nDefinition foo28 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo28.\r\nDefinition foo29 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo29.\r\nDefinition foo30 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo30.\r\nDefinition foo31 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo31.\r\nDefinition foo32 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo32.\r\nDefinition foo33 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo33.\r\nDefinition foo34 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo34.\r\nDefinition foo35 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo35.\r\nDefinition foo36 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo36.\r\nDefinition foo37 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo37.\r\nDefinition foo38 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo38.\r\nDefinition foo39 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo39.\r\nDefinition foo40 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo40.\r\nDefinition foo41 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo41.\r\nDefinition foo42 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo42.\r\nDefinition foo43 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo43.\r\nDefinition foo44 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo44.\r\nDefinition foo45 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo45.\r\nDefinition foo46 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo46.\r\nDefinition foo47 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo47.\r\nDefinition foo48 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo48.\r\nDefinition foo49 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo49.\r\nDefinition foo50 := Eval vm_compute in Coq.ZArith.BinInt.Z.div_eucl. Print foo50.\r\n```\r\nThe *coq-log* ends with\r\n```coq\r\n                           for Ffix0) x4 BinNums.xH)\r\n                   | BinNums.Zneg x4 =>\r\n                       (fix Ffix0 (x5 x6 : BinNums.positive) {struct x6} : \r\nBinNums.Z :=\r\n                          match x5 with\r\n                          | BinNums.xI x7 =>\r\n                              match x6 with\r\n                              | BinNums.xI x8 =>\r\n                                  match Ffix0 x7 x8 with\r\n                                  | BinNums.Z0 => BinNums.Z0\r\n                                  | BinNums.Zpos x9 => BinNums.Zpos (BinNums.xO \r\nx9)\r\n                                  | BinNums.Zneg x9 => BinNums.Zneg (BinNums.xO \r\nx9)\r\n                                  end\r\n                              | BinNums.xO x8 =>\r\n                                  match Ffix0 x7 x8 with\r\n                                  | BinNums.Z0 => BinNums.Zpos 1\r\n                         �Error: Anomaly: main loop exited with exception: \r\nSys.Break\r\n Please report at http://coq.inria.fr/bugs/.�\r\n\r\n<prompt>Coq < 25 || 0 < </prompt>\r\n```","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547864","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547864","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547864,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T20:42:22Z","updated_at":"2017-10-18T10:43:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nNote that in the xml protocol, this can lead to mal-formed xml, because you get \nan anomaly message in the middle of an ill-balanced xml printout\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547865","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547865","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547865,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-05T06:50:53Z","updated_at":"2017-10-18T10:43:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @silene\n\nI guess no one ever thought a user would be C-c-ing right in the middle of the pretty-printing of a constr.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547866","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547866","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547866,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-05T07:42:51Z","updated_at":"2017-12-07T07:17:09Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\r\n\r\nIndeed Coq is fragile wrt signal protection, however this is a delicate topic and IMVHO the strategy should be carefully designed, not patched around.\r\n\r\nFor a start, I could identify two critical paths where signals should be protected:\r\n\r\n- message delivery (as in this case).\r\n- stm commit + notification: the rationale for this is that Coq should ensure atomicity on STM commit. That is to say, it should never be the case that a STM transaction has been commited but the commit message not delivered to the user, as this will make user-side interruption recovery impossible.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547868","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547868","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547868,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T09:50:01Z","updated_at":"2017-10-18T10:43:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nHi Jason, does this patch help https://github.com/ejgallego/coq/tree/protect_pp_p1 ?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547869","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547869","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547869,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg2OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T09:52:11Z","updated_at":"2017-10-18T10:43:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI could also try to improve the problem in the XML protocol, how can I reproduce there?\n\n[We have too many \"printing\" codepaths, work in the pp_new branch unifies all of them so blocking could be improved in 8.7 I hope]\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547874","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547874","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547874,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg3NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T09:58:11Z","updated_at":"2017-10-18T10:43:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\nShouldn't the protection be put at a much higher level? By working at a too low level, there would still be code executed interleaved with the gen_logger which would not be protected, right?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547877","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547877","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547877,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg3Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T09:58:55Z","updated_at":"2017-10-18T10:43:12Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nNote however than I can't reproduce your bug, even without the patch I never get the Anomaly.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547878","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547878","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547878,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg3OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T10:01:19Z","updated_at":"2017-10-18T10:43:12Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\n(In reply to Hugo Herbelin from comment [BZ#6](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%236%22))\n> Shouldn't the protection be put at a much higher level? By working at a too\n> low level, there would still be code executed interleaved with the\n> gen_logger which would not be protected, right?\n\nI don't think so.\n\nIMO blocking should happen for the shortest time possible, and indeed, we just make flushing to the console atomic so it will always print a full message.\n\nI don't see what code could be interleaved with gen_logger, do you have an example?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547881","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547881","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547881,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg4MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T10:12:43Z","updated_at":"2017-10-18T10:43:12Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\nIf my understanding is right, Sys.Break stops to be caught in the last \"with\" branch of Coqloop.do_vernac. So, all code in there is currently unprotected. (And moreover, this code does not apparently call Feedback.)\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547883","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547883","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547883,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg4Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T10:24:30Z","updated_at":"2017-10-18T10:43:12Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\n (In reply to Hugo Herbelin from comment [BZ#9](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%239%22))\n> If my understanding is right, Sys.Break stops to be caught in the last\n> \"with\" branch of Coqloop.do_vernac.\n\nIMO that should really happen in the STM to perform transaction cleanup (dunno if it does it now).\n\n> So, all code in there is currently\n> unprotected. (And moreover, this code does not apparently call Feedback.)\n\nWhat do you mean by \"unprotected\".\n\nThe code indeed will call Feedback.gen_logger if any printing is done. \n\nIf we disregard for a moment transactional semantics (a orthogonal issue to this bug) we only want to guard the call console code.\n\nNote that in XML case the codepath is totally different, there we'd like to guard the whole write to the socket / feedback.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547886","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547886","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547886,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg4Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T11:42:25Z","updated_at":"2017-10-18T10:43:12Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\nI actually don't know if Jason's report refers to asynchronous PG or not. I assumed the latter, and, based on the error message, this would come from Coqloop.do_vernac after succeeding in sending two consecutive Ctrl-C quickly enough so that the Print is interrupted, going to the Coqloop.do_vernac \"with\", being again interrupted and going to the Coqloop.loop \"with\". This is why I said the protection should be at a higher level (i.e. in Coqloop). For the stm path, I don't know where it should be, but I guess it should also be at a high level so that the whole path is protected (where by protected I mean protected by a \"try ... with Sys.Break -> ...\" or a deactivation of the Ctrl-C).\n\nNote: I don't know well how Sys.Break works in OCaml, if a second Ctrl-C arrives while the Sys.Break is matched by the surrounding \"try ... with Sys.Break -> ...\", can a second Sys.Break arrive again? I guess so, otherwise the bug would not happen. But then, this would mean that there is a gray zone in the internal OCaml path to protect, no?\n\nNow, what to do? If my analysis is correct, and that it is moreover hardly reproducible, maybe we should simply take it lightly and let it like that (or replace the anomaly by a congratulation for having succeeded to send successive Ctrl-C quickly enough!).\n\nAs for the stm, how are the writes to sockets working? Are there under control of OCaml (in the sense of not escaping the protection of a surrounding \"try ... with Sys.Break -> ...\")? If not, they should indeed be protected.\n\nEmilio, I hope that what I'm writing is clear and that I understood correctly all your concerns. In any case, there is indeed a lot to do to improve Coq.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547886/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547887","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547887","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547887,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg4Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T12:50:04Z","updated_at":"2017-12-07T07:17:21Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\r\n\r\nHi Hugo,\r\n\r\nyou are correct, there seem to be two issues here:\r\n\r\n - protecting the print path so that no message is half sent (this is an issue in the XML protocol, not so much here I'd guess).\r\n - protecting the exception handler in do_vernac.\r\n\r\nAFAIK the status of exception handler in ocaml wrt signals is a bit strange in the sense that signals are not processed synchronously.\r\n\r\nMy guess is that we should ignore SIGINT in do_vernac as you propose and mask the signal in the first case to avoid incomplete input/output (we may need to use the unix module for this).\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547888","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547888","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547888,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg4OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T13:11:53Z","updated_at":"2017-12-07T07:17:29Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\r\n\r\nI think an Ocaml expert should comment on signal behavior, but here are some further thoughts:\r\n\r\n- coqloop.ml:loop should run with sigint disabled, otherwise you always have the window between do_vernac and flush where sigint could arrive.\r\n- thus, do_vernac should enable sigint as it is prepared to handle, and disable it on exit or on the exception handler.\r\n\r\nI think that should work but I am not sure.\r\n\r\nHere's a patch implementing that proposal:\r\n\r\nhttps://github.com/ejgallego/coq/tree/protect_coqloop_p1\r\n\r\nThe general loop code could maybe be tweaked for the signal handling to be cleaner, but I didn't want to mess too much with the loop at this stage.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547888/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547890","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547890","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547890,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:05:36Z","updated_at":"2017-10-18T10:43:13Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\nYour patch looks good to me, as far as I can say.\n\n\"Sys.set_signal Sys.sigint Sys.Signal_ignore\" can just be \"Sys.catch_break false\" I think.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547891","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547891","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547891,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:06:05Z","updated_at":"2017-10-18T10:43:14Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nThe anomaly is visible in synchronous PG.  Async PG has slightly different behavior, see https://github.com/psteckler/ProofGeneral/issues/48\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547891/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547893","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547893","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547893,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:10:08Z","updated_at":"2017-10-18T10:43:14Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nIf this patch means that printing is no longer interruptible, then I don't like it.  Printing a term can take arbitrarily long, and if I have a long file, I'm going to be very sad if I have to force-kill Coq and restart it because I ended up with a goal that took an hour to print.  The anomaly is better, in this case.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547894","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547894","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547894,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:15:51Z","updated_at":"2017-10-18T10:43:14Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\n(In reply to Hugo Herbelin from comment [BZ#14](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%2314%22))\n> Your patch looks good to me, as far as I can say.\n> \n> \"Sys.set_signal Sys.sigint Sys.Signal_ignore\" can just be \"Sys.catch_break\n> false\" I think.\n\nI think this will make Coq abort on SIGINT, based on the code on Ocaml's sys.mlp\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547896","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547896","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547896,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:22:38Z","updated_at":"2017-10-18T10:43:14Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\n(In reply to Jason Gross from comment [BZ#16](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%2316%22))\n> If this patch means that printing is no longer interruptible, then I don't\n> like it.  Printing a term can take arbitrarily long, and if I have a long\n> file, I'm going to be very sad if I have to force-kill Coq and restart it\n> because I ended up with a goal that took an hour to print.  The anomaly is\n> better, in this case.\n\nThese are two orthogonal issues as Hugo discovered. The second patch still allows for printing to be interrupted. The first one deals with printing.\n\nWould you mind testing the second patch?\n\nRegarding printing, note that what is protected is the actual IO, which takes in general negligible time wrt to the Print command itself.\n\nI don't have stronger views here either way, but for instance in SerAPI SEXP IO will be indeed non-interruptible with SIGINT, I don't want clients to have to deal with possibly malformed answers and re-synchronization. IMO the benefits of a more reliable interruption behavior outdo the downsides of some IO wait.\n\nYou could still kill Coq if the IO goes mad, of course (but if you reach this case then you got bigger problems that that given that IO can easily do a few dozen MiB/s)\n\nThis could be alleviated in the far future by introducing multiplexing, however I'd like to have a use case first.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547899","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547899","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547899,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0Nzg5OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:37:53Z","updated_at":"2017-10-18T10:43:15Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\n(In reply to Emilio J. Gallego Arias from comment [BZ#17](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%2317%22))\n> (In reply to Hugo Herbelin from comment [BZ#14](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%2314%22))\n> > Your patch looks good to me, as far as I can say.\n> > \n> > \"Sys.set_signal Sys.sigint Sys.Signal_ignore\" can just be \"Sys.catch_break\n> > false\" I think.\n> \n> I think this will make Coq abort on SIGINT, based on the code on Ocaml's\n> sys.mlp\n\nOK, I see. So, how to proceed? You submit it as a pull request?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547899/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547901","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547901","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547901,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkwMQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T14:43:35Z","updated_at":"2017-10-18T10:43:15Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI suggest we first let Jason test the patch and see if they witnes some improvement.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547904","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547904","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547904,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkwNA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T18:07:57Z","updated_at":"2017-12-07T07:18:05Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nThe way that I reliably reproduce it is that I wait until it's just finished \r\nevaluating a Definition / just started evaluating a Print, and then I hold down \r\nCtrl+c until Coq stops processing.\r\n\r\nEmilio, your https://github.com/ejgallego/coq/tree/protect_coqloop_p1 patch \r\nseems to reliably fix the anomaly.  (That is, I get a partial print-out \r\ninterrupted by the text \"User interrupt\" rather than an anomaly.)  Thanks!\r\n\r\nYour patch in https://github.com/ejgallego/coq/tree/protect_pp_p1 is one I'd \r\nrather not see applied.  It makes it impossible to kill Coq from PG while it's \r\nbusy printing, and impossible to interrupt printing.  For example, try \r\ninterrupting the [Print foo0] in this:\r\n```coq\r\nRequire Coq.ZArith.BinInt Coq.Lists.List.\r\nDefinition foo0 := Eval vm_compute in let x := Coq.ZArith.BinInt.Z.div_eucl in \r\n(x::x::x::x::x::x::x::x::x::nil)%list.\r\nPrint foo0.\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547906","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547906","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547906,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkwNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T21:53:01Z","updated_at":"2017-10-18T10:43:15Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nThanks for the feedback Jason, I'll investigate a bit more. Indeed, the print locking patch behavior is as intended, you need to use C-c C-x to kill Coq in this case. \"Perform a full reset\". Anyways the print shouldn't take so much so I want to take another look.\n\n(Maybe blocking instead of ignoring the signal will work better)\n\nI also agree on not to applying this patch for emacs as it anyways has to re-synchronize so the patch is not needed.\n\nHowever, in the case of the XML/SerAPI protocol, some measures have to be taken to protect the control protocol as, contrary to the emacs case, this protocol has no resync system put in place.\n\nThis may indeed involve some tradeoff between interrupt flexibility and safety.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547907","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547907","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547907,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkwNw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T21:59:07Z","updated_at":"2017-10-18T10:43:16Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nC- c C-x doesn't work when I've applied your patch; I've often found that killing Coq when C-c C-c fails just makes emacs hang.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547908","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547908","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547908,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkwOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-07T09:49:35Z","updated_at":"2017-10-18T10:43:16Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nThanks for the feedback Jason. I'll do some more experiments and submit a PR next week. Regarding the printing stuff, with the current design we face a tradeoff between robustness and responsiveness.\n\nI'd personally favor robustness in the PG-XML branch, IMHO it should be possible to make C-c C-x to work well for the rare cases of massive IO waiting.\n\nHopefully in future protocol improvements we can have both.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547910","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547910","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547910,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkxMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-15T17:32:11Z","updated_at":"2017-10-18T10:43:16Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\n\nWhat if Coq inserted a special end-of-transmission marker in the XML stream after an interrupt? That would allow long prints to be interrupted, and an IDE would know not to try to parse the result as XML, and possibly recover.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547911","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-337547911","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":337547911,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NzkxMQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-10-15T23:32:21Z","updated_at":"2017-10-18T10:43:16Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nIMO this special marker is what we have called sometimes \"a resync protocol\". It would be fine, but I think it is overkill. In particular the marker doesn't suffice alone, you need also to query Coq for state consistency status.\n\nI would prefer to have separate control/printing channels, and have a simpler interruption protocol where IDEs assume transaction consistency until the interrupt, but of course we have to discuss.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337547911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/419923969","html_url":"https://github.com/coq/coq/issues/5120#issuecomment-419923969","issue_url":"https://api.github.com/repos/coq/coq/issues/5120","id":419923969,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTkyMzk2OQ==","user":{"login":"ejgallego","id":7192257,"node_id":"MDQ6VXNlcjcxOTIyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7192257?v=4","gravatar_id":"","url":"https://api.github.com/users/ejgallego","html_url":"https://github.com/ejgallego","followers_url":"https://api.github.com/users/ejgallego/followers","following_url":"https://api.github.com/users/ejgallego/following{/other_user}","gists_url":"https://api.github.com/users/ejgallego/gists{/gist_id}","starred_url":"https://api.github.com/users/ejgallego/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ejgallego/subscriptions","organizations_url":"https://api.github.com/users/ejgallego/orgs","repos_url":"https://api.github.com/users/ejgallego/repos","events_url":"https://api.github.com/users/ejgallego/events{/privacy}","received_events_url":"https://api.github.com/users/ejgallego/received_events","type":"User","site_admin":false},"created_at":"2018-09-10T14:03:33Z","updated_at":"2018-09-10T14:03:33Z","author_association":"MEMBER","body":"Sadly I don't plan to address this in 8.9, hoping to be better for 8.10.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/419923969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]