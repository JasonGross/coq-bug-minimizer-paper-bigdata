[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556167","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556167","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556167,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE2Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-08-01T17:29:49Z","updated_at":"2017-10-24T23:50:47Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n```coq\r\n$ cat foo.v\r\n(* -*- coq-prog-args: (\"-debug\") -*- *)\r\nGoal True.\r\n  do 3 simple refine (let _ := _ in _).\r\n  { Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\nAbort.\r\n```\r\n```\r\n$ ~/.local64/coq/coq-8.6.1/bin/coqc foo.v\r\nFinished transaction in 0.32 secs (0.236u,0.083s) (successful)\r\nFinished transaction in 0.264 secs (0.231u,0.035s) (successful)\r\nundone\r\nFinished transaction in 0.202 secs (0.183u,0.02s) (successful)\r\nFinished transaction in 0.4 secs (0.388u,0.011s) (successful)\r\nFinished transaction in 0.361 secs (0.351u,0.008s) (successful)\r\nundone\r\nFinished transaction in 1.117 secs (1.096u,0.019s) (successful)\r\nFinished transaction in 0.746 secs (0.728u,0.02s) (successful)\r\nFinished transaction in 2.556 secs (2.551u,0.004s) (successful)\r\nFinished transaction in 1.715 secs (1.716u,0.004s) (successful)\r\nFinished transaction in 3.69 secs (3.676u,0.011s) (successful)\r\nundone\r\nFinished transaction in 3.786 secs (3.779u,0.008s) (successful)\r\nFinished transaction in 5.228 secs (5.219u,0.008s) (successful)\r\nFinished transaction in 6.258 secs (6.248u,0.012s) (successful)\r\nFinished transaction in 7.701 secs (7.703u,0.s) (successful)\r\nFinished transaction in 9.162 secs (9.144u,0.019s) (successful)\r\nFinished transaction in 10.907 secs (10.896u,0.016s) (successful)\r\nFinished transaction in 12.912 secs (12.911u,0.004s) (successful)\r\nundone\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556167/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556168","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556168","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556168,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE2OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T15:58:54Z","updated_at":"2017-10-24T23:51:17Z","author_association":"CONTRIBUTOR","body":"Comment author: @silene\r\n\r\nNo need for \"Require Import\", the behavior is insane with plain tactics too. (Exercise: use Coq's output to draw Koch's snowflake.)\r\n```coq\r\nGoal True.\r\n  idtac \"before 1\". idtac \"1\". Undo. idtac \"after 1\".\r\n  idtac \"before 2\". idtac \"2\". Undo. idtac \"after 2\".\r\n  idtac \"before 3\". idtac \"3\". Undo. idtac \"after 3\".\r\n  idtac \"before 4\". idtac \"4\". Undo. idtac \"after 4\".\r\nAbort.\r\n```\r\n```\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\n3\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\nafter 3\r\nbefore 4\r\n4\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\n3\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\nafter 3\r\nbefore 4\r\nafter 4\r\nbefore 1\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\n3\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\n2\r\nbefore 1\r\n1\r\nbefore 1\r\nafter 1\r\nbefore 2\r\nafter 2\r\nbefore 3\r\nafter 3\r\nbefore 4\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556168/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556169","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556169","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556169,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE2OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T16:01:16Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nCan we get a bisect on this?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556169/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556171","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556171","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556171,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T16:03:54Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @silene\n\nSince this behavior predates 8.5, I guess a bisection will just point to the STM merge.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556172","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556172","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556172,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T17:22:04Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nYup, unfortunately the document traversal has some issues, but we are working on that, a PR is on sight.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556174","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556174","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556174,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T16:00:50Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nWell, this bug is a bit subtle as in that there is a tradeoff here. Let's name:\n\n+ S/M = time/memory size of command state,\n+ K = avg time of command execution,\n+ N = number of sentences in the document.\n\nUsually S << K.\n\nNow, Coq has two strategies to keep track of backtracking state:\n\n- in interactive mode, Coq will cache all intermediate states, thus:\n  + memory use = O(M*N)\n  + backtracking time = O(S) ≈ O(1)\n\n- in batch mode, Coq won't cache any intermediate state, thus:\n  + memory use = O(M) ≈ O(1)\n  + backtracking time = O(K*N)\n\nindeed, in batch mode, Undo and friend have to re-execute all previous commands to recreate state. We could improve this, however at a non-trivial memory cost.\n\nI think that a possible compromise could be to add a warning so that `Undo` and friends are discouraged in batch mode. Thoughts?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556175","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556175","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556175,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T19:25:49Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\n> We could improve this, however at a non-trivial memory cost.\n\nNo, it is quite easy to do better with cost roughly O(N): when re-executing commands to perform an Undo, first preprocess the list of commands \"executing\" only the backtracking ones to get a minimized list of commands without Undo.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556177","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556177","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556177,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T21:31:52Z","updated_at":"2017-10-18T11:09:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI am not sure I follow Jason, care to expand on your idea?\n\nOf course my analysis doesn't account for any optimizations, indeed you could have better heuristics for caching if you know the future; but I was implicitly talking about worst-case cost.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556178","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556178","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556178,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE3OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T21:36:58Z","updated_at":"2017-10-24T23:53:31Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nSuppose you have a list of commands like `A. B. C. Undo. C'. Undo 2. B'. C''.` and now you want to `Undo.`  You need not run `A. B. C. Undo. C'. Undo 2. B'. C''.`, but merely `A. B'. C''`, and computing this list should be cheap compared to the time it takes to execute the commands.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556180","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556180","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556180,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE4MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T22:48:48Z","updated_at":"2017-10-18T11:09:56Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI see, thanks. A couple of comments:\n\n- Your proposal is not easy to do with the current codebase of the STM [the function to modify is Reach.known_state]; once we land the new traversal code, IMHO this kind of analysis should be much more feasible, in fact, this is one of the reasons to land it and separate scheduling from document building.\n\n- There is honestly not a lot of motivation to support this rare use case of `Undo` commands appearing in scripts processed by coqc. We could always allow the user to enable the cache if desired.\n\n- Your proposal also has a terrible worst case cost. Undo after 100 commands = 100 commands re-executed.\n\nI indeed wish we could keep the cache, however proof terms may be very large and coqc users will notice.\n\nIMHO, a warning is the way to go.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556180/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556181","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556181","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556181,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE4MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T23:02:04Z","updated_at":"2017-10-18T11:09:56Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nOk folks, https://github.com/coq/coq/pull/1096\n\nI am very inclined to close this as WONTFIX once the PR lands in trunk. If you want to cache backtracking results then don't use batch mode.\n\nA feature request for an option enabling caching in batch mode would also make sense; but it'll have to be 8.8 material.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556184","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556184","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556184,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE4NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-26T05:18:10Z","updated_at":"2017-10-24T23:52:57Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nNo, this should not be closed as WONTFIX, because the problem exists even in interactive mode (though only for [Require Import], not for [idtac]), when (it seems) it should not:\r\n```coq\r\n$ cat bar.v\r\n(* -*- coq-prog-args: (\"-debug\") -*- *)\r\nSet Silent.\r\nGoal True.\r\n  do 3 simple refine (let _ := _ in _).\r\n  { Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\n    Time Require Import Coq.micromega.Lia Coq.omega.Omega. Undo. idtac \"undone\".\r\nAbort.\r\n```\r\n```\r\n$ ~/.local64/coq/coq-master/bin/coqtop < bar.v\r\nWelcome to Coq jgross-Leopard-WS:/home/jgross/Downloads/coq/coq-master,master (3072bd9d080984833f5eb007bf15c6e9305619e3)\r\n\r\nCoq < Coq <\r\nCoq <\r\nUnnamed_thm <\r\nUnnamed_thm <\r\nFinished transaction in 0.273 secs (0.232u,0.04s) (successful)\r\nFinished transaction in 0.286 secs (0.252u,0.036s) (successful)\r\n\r\n\r\nundone\r\n\r\nUnnamed_thm < Finished transaction in 0.21 secs (0.199u,0.011s) (successful)\r\nFinished transaction in 0.558 secs (0.544u,0.016s) (successful)\r\n\r\n\r\nundone\r\n\r\nUnnamed_thm < Finished transaction in 0.957 secs (0.944u,0.011s) (successful)\r\nFinished transaction in 0.646 secs (0.619u,0.023s) (successful)\r\n\r\n\r\nundone\r\n\r\nUnnamed_thm < Finished transaction in 1.699 secs (1.68u,0.019s) (successful)\r\nFinished transaction in 2.458 secs (2.452u,0.008s) (successful)\r\n\r\n\r\nundone\r\n\r\nUnnamed_thm <\r\n...\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556185","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-337556185","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":337556185,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1NjE4NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-09-26T11:09:02Z","updated_at":"2017-10-18T11:09:56Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI agree that there is a bug in the interactive case.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337556185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/339170858","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-339170858","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":339170858,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTE3MDg1OA==","user":{"login":"ejgallego","id":7192257,"node_id":"MDQ6VXNlcjcxOTIyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/7192257?v=4","gravatar_id":"","url":"https://api.github.com/users/ejgallego","html_url":"https://github.com/ejgallego","followers_url":"https://api.github.com/users/ejgallego/followers","following_url":"https://api.github.com/users/ejgallego/following{/other_user}","gists_url":"https://api.github.com/users/ejgallego/gists{/gist_id}","starred_url":"https://api.github.com/users/ejgallego/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ejgallego/subscriptions","organizations_url":"https://api.github.com/users/ejgallego/orgs","repos_url":"https://api.github.com/users/ejgallego/repos","events_url":"https://api.github.com/users/ejgallego/events{/privacy}","received_events_url":"https://api.github.com/users/ejgallego/received_events","type":"User","site_admin":false},"created_at":"2017-10-24T23:54:14Z","updated_at":"2017-10-24T23:54:14Z","author_association":"MEMBER","body":"> `A. B. C. Undo. C'. Undo 2. B'. C''`., but merely `A. B'. C''`\r\n\r\nNote that this optimization is unsound if, for example, `C'` fails.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/339170858/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/339199743","html_url":"https://github.com/coq/coq/issues/5677#issuecomment-339199743","issue_url":"https://api.github.com/repos/coq/coq/issues/5677","id":339199743,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTE5OTc0Mw==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2017-10-25T03:03:43Z","updated_at":"2017-10-25T03:03:43Z","author_association":"MEMBER","body":"If `C'` fails it should be dropped from the log of statements that have happened.  I'm not saying to skip it the first time through, just to skip it on replay, when you have enough information to do so.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/339199743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]