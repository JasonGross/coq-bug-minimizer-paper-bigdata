[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541608","html_url":"https://github.com/coq/coq/issues/4672#issuecomment-337541608","issue_url":"https://api.github.com/repos/coq/coq/issues/4672","id":337541608,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTYwOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-04-15T19:16:43Z","updated_at":"2017-10-18T10:22:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nHere is code that works in Coq 8.4pl6 but fails in Coq 8.5.\n\n(* -*- mode: coq; coq-prog-args: (\"-emacs\" \"-R\" \".\" \"Fiat\" \"-top\" \"bug_bro_no_setoid_03\") -*- *)\n(* File reduced by coq-bug-finder from original input, then from 2227 lines to 80 lines, then from 201 lines to 85 lines, then from 680 lines to 156 lines, then from 407 lines to 203 lines, then from 356 lines to 247 lines, then from 370 lines to 273 lines, then from 450 lines to 331 lines, then from 506 lines to 333 lines, then from 536 lines to 332 lines, then from 843 lines to 338 lines, then from 639 lines to 376 lines, then from 1087 lines to 390 lines, then from 2227 lines to 392 lines, then from 453 lines to 393 lines, then from 416 lines to 393 lines, then from 511 lines to 418 lines, then from 571 lines to 450 lines, then from 630 lines to 513 lines, then from 527 lines to 514 lines, then from 449 lines to 199 lines, then from 213 lines to 199 lines, then from 190 lines to 120 lines, then from 134 lines to 120 lines *)\n(* coqc version 8.5 (February 2016) compiled on Feb 21 2016 15:26:16 with OCaml 4.02.3\n   coqtop version 8.5 (February 2016) *)\nAxiom proof_admitted : False.\nTactic Notation \"admit\" := case proof_admitted.\nRequire Coq.Lists.SetoidList.\nRequire Coq.Strings.String.\nImport Coq.Strings.String.\nSection item.\n  Context {Char : Type}.\n  Inductive item :=\n  | Terminal (_ : Char -> bool)\n  | NonTerminal (_ : string).\nEnd item.\nArguments item _ : clear implicits.\nClass parser_computational_predataT :=  { nonterminals_listT : Type }.\nClass split_dataT `{parser_computational_predataT} := {  }.\nImport Coq.Lists.SetoidList.\nGlobal Set Implicit Arguments.\nHint Extern 0 => solve [apply reflexivity] : typeclass_instances.\nAxiom list_caset\n  : forall A (P : list A -> Type) (N : P nil) (C : forall x xs, P (x::xs)) ls,\n    P ls.\nGlobal Instance list_caset_Proper {A P}\n  : Proper (eq\n              ==> pointwise_relation _ (pointwise_relation _ eq)\n              ==> pointwise_relation _ eq)\n           (@ list_caset A (fun _ => P)).\nAdmitted.\nInductive RCharExpr (Char : Type) := .\nInductive ritem Char :=\n| RTerminal (_ : RCharExpr Char)\n| RNonTerminal (_ : String.string).\nAxiom interp_RCharExpr : forall {Char} (expr : RCharExpr Char), Char -> bool.\nAxiom interp_ritem : forall {Char} (expr : ritem Char), item Char.\nDefinition rdp_list_nonterminals_listT : Type.\n  exact (list nat).\nDefined.\nGlobal Instance rdp_list_predata : @ parser_computational_predataT\n  := { nonterminals_listT := rdp_list_nonterminals_listT }.\nLemma item_rect_ritem_rect {C A T NT} it\n  : item_rect (fun _ : item C => A) T NT (interp_ritem it)\n    = ritem_rect (fun _ => A) (fun f => T (interp_RCharExpr f)) NT it.\n  admit.\nDefined.\nGoal forall (Char : Type),\n    let predata := @ rdp_list_predata in\n    forall (splitdata : @ split_dataT   predata) (a11 : ritem Char)\n           (xs : list (ritem Char)) (P : bool -> Prop) (b : bool -> bool -> bool)\n           (b1 : (Char -> bool) -> list bool) (b2 : string -> list bool)\n           (l1 : (Char -> bool) -> list bool)\n           (l3 : @ split_dataT\n                   {|\n                     nonterminals_listT := list nat |} ->\n                 list bool) (b7 : bool),\n      P\n        (@ fold_left bool bool b\n                    (@ list_caset (ritem Char) (fun _ : list (ritem Char) => list bool)\n                                 (@ item_rect Char (fun _ : item Char => list bool) b1 b2 (@ interp_ritem Char a11))\n                                 (fun (_ : ritem Char) (_ : list (ritem Char)) =>\n                                    @ item_rect Char (fun _ : item Char => list bool) l1 (fun _ : string => l3 splitdata)\n                                               (@ interp_ritem Char a11)) xs) b7).\n  intros.\n  progress repeat setoid_rewrite item_rect_ritem_rect; cbv beta.\n  Set Printing Implicit.\n  let G := match goal with |- ?G => G end in\n  match goal with\n  | [ |- appcontext[@ item_rect] ]\n    => fail 1 \"Goal still has item_rect:\" G\n  | _ => repeat match goal with H : _ |- _ => revert H end;\n           let G := match goal with |- ?G => G end in\n           idtac \"Goal is correct:\" G\n  end.\n\n(* Error: Tactic failure: Goal still has item_rect:\n(P\n   (@ fold_left bool bool b\n      (@ list_caset (ritem Char) (fun _ : list (ritem Char) => list bool)\n         (@ ritem_rect Char (fun _ : ritem Char => list bool)\n            (fun f : RCharExpr Char => b1 (@ interp_RCharExpr Char f)) b2 a11)\n         (fun (_ : ritem Char) (_ : list (ritem Char)) =>\n          @ item_rect Char (fun _ : item Char => list bool) l1 (fun _ : string => l3 splitdata)\n            (@ interp_ritem Char a11)) xs) b7)).\n *)\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541610","html_url":"https://github.com/coq/coq/issues/4672#issuecomment-337541610","issue_url":"https://api.github.com/repos/coq/coq/issues/4672","id":337541610,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTYxMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-04-16T22:44:26Z","updated_at":"2017-10-18T10:22:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 699\nbuggy file, and typeclass resolution log\n\nHere's a smaller example, where something fishy is going on: [rewrite] works in both 8.4 and 8.5, but [setoid_rewrite] fails only in 8.5.  Removing the external [apply reflexivity] hint makes it fail in 8.4.\n\n\n(* -*- mode: coq; coq-prog-args: (\"-emacs\" \"-R\" \".\" \"Fiat\" \"-top\" \"bug_bro_no_setoid_03\" \"-R\" \".\" \"Top\") -*- *)\n(* File reduced by coq-bug-finder from original input, then from 2227 lines to 80 lines, then from 201 lines to 85 lines, then from 680 lines to 156 lines, then from 407 lines to 203 lines, then from 356 lines to 247 lines, then from 370 lines to 273 lines, then from 450 lines to 331 lines, then from 506 lines to 333 lines, then from 536 lines to 332 lines, then from 843 lines to 338 lines, then from 639 lines to 376 lines, then from 1087 lines to 390 lines, then from 2227 lines to 392 lines, then from 453 lines to 393 lines, then from 416 lines to 393 lines, then from 511 lines to 418 lines, then from 571 lines to 450 lines, then from 630 lines to 513 lines, then from 527 lines to 514 lines, then from 449 lines to 199 lines, then from 213 lines to 199 lines, then from 190 lines to 120 lines, then from 134 lines to 120 lines, then from 70 lines to 50 lines, then from 64 lines to 50 lines, then from 52 lines to 30 lines, then from 44 lines to 31 lines *)\n(* coqc version 8.5 (February 2016) compiled on Feb 21 2016 15:26:16 with OCaml 4.02.3\n   coqtop version 8.5 (February 2016) *)\nRequire Import Coq.Strings.String.\nRequire Import Coq.Setoids.Setoid.\nRequire Import Coq.Classes.Morphisms.\nHint Extern 0 => solve [apply RelationClasses.reflexivity] : typeclass_instances.\nAxiom list_caset : forall {A} (P : list A -> Type) (N : P nil) (C : forall x xs, P (cons x xs)) ls, P ls.\nGlobal Instance list_caset_Proper {A P}\n  : Proper (eq\n              ==> pointwise_relation _ (pointwise_relation _ eq)\n              ==> pointwise_relation _ eq)\n           (@ list_caset A (fun _ => P)).\nAdmitted.\nInductive item : Type := .\nInductive ritem : Type := .\nAxiom interp_ritem : forall (expr : ritem), item.\nAxiom item_rect_ritem_rect : forall {A} it, item_rect (fun _ : item => A) (interp_ritem it) = ritem_rect (fun _ => A) it.\nGoal forall (a11 : ritem) (xs : list ritem)\n            (l3 : string -> list bool)\n            (l : list bool) (k : list bool -> Prop),\n    k (@ list_caset (ritem) (fun _ : list (ritem) => list bool) l\n                   (fun (_ : ritem) (_ : list ritem) =>\n                      @ item_rect (fun _ : item => list bool) (@ interp_ritem a11)) xs).\n  intros.\n  Set Typeclasses Debug.\n  setoid_rewrite item_rect_ritem_rect.\n\n\nThis file, along with the typeclass log, is attached.\n\n> Attached file: [bug_bro_no_setoid_08.v](https://coq.inria.fr/bugfiles/attachment.cgi?id=699) (text/plain, 85000 bytes)\n> Description:   buggy file, and typeclass resolution log\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541610/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541612","html_url":"https://github.com/coq/coq/issues/4672#issuecomment-337541612","issue_url":"https://api.github.com/repos/coq/coq/issues/4672","id":337541612,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MTYxMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-07-21T14:45:25Z","updated_at":"2017-10-18T10:22:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @mattam82\n\nThe quick fix is to add:\n\nInstance subrelation_pointwise A B (R : relation B) :\n  subrelation (pointwise_relation A R) (eq ==> R)%signature.\nProof. reduce. subst; firstorder. Qed.\n\nOr redefine list_caset_Proper to use respectful (==>) instead of forall_relation\nwhere applicable (as you know that you're in a non-dependent case). The reason\nis that rewrite is able to profit from the fact that this is non-dependent and \nnow\ninfers a (==>) constraint instead of the previous (forall_relation _ _) \nconstraint \n(just look at the first constraints in the proof search). forall_relation is \nitself \nconvertible to pointwise_relation in the non-dependent case.\n\nI'm trying out the stdlib with this instance added. But more likely I'll use \nthe compat\nflag to disable the reduction that makes this possible for compatibility with \n8.4.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337541612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/353597068","html_url":"https://github.com/coq/coq/issues/4672#issuecomment-353597068","issue_url":"https://api.github.com/repos/coq/coq/issues/4672","id":353597068,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzU5NzA2OA==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2017-12-22T13:19:44Z","updated_at":"2017-12-22T13:19:44Z","author_association":"MEMBER","body":"This is a bug affecting an already old version, and it is unlikely both that we fix it and that it would help you. Therefore I'll close it as WONTFIX.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/353597068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]