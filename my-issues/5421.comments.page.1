[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552331","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552331","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552331,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjMzMQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T06:29:09Z","updated_at":"2017-10-18T10:57:47Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nSee \nhttps://github.com/JasonGross/slow-coq-examples/tree/master/slow_fiat_crypto_vm_native_no_op, \nor the attached zip file.  There are two [vm_compute]s each of which takes \nabout 15-20 seconds.  See README.md for details.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552334","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552334","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552334,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjMzNA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T06:29:14Z","updated_at":"2017-10-18T10:57:47Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 821\nfiat-crypto repo\n\n> Attached file: [slow_fiat_crypto_vm_native_no_op.zip](https://coq.inria.fr/bugfiles/attachment.cgi?id=821) (application/zip, 417445 bytes)\n> Description:   fiat-crypto repo\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552335","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552335","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552335,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjMzNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T17:52:24Z","updated_at":"2017-10-18T10:57:47Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\n\nFor the file AddCoordinatesSlowExample.v, the most costly items in the profile when running the [vm_compute]:\n\n- 65.99%  coqtop\n - __mcount_internal\n  - 95.16% _mcount\n    - 41.34% camlCList__it_list_f_1844\n      - camlCClosure__defined_rels_5697\n      - camlCClosure__create_5759\n       + 96.71% camlReduction__whd_all_4888\n       + 2.26% camlReduction__clos_gen_conv_5811\n       + 0.74% camlReduction__whd_betaiotazeta_4885\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552335/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552338","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552338","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552338,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjMzOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-08T14:47:41Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI can't reproduce the slowness on trunk.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552339","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552339","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552339,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjMzOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-08T15:56:27Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n(In reply to Pierre-Marie PÃ©drot from comment [BZ#3](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%233%22))\n> I can't reproduce the slowness on trunk.\n\nSorry, I was not using the right file. Indeed there is something wrong going on.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552341","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552341","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552341,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjM0MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-08T17:02:02Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nAll right, VM compute is slow because it recomputes normal of inductive types. The following patch divides by 4 the definition time:\n\n--- a/pretyping/vnorm.ml\n+++ b/pretyping/vnorm.ml\n@ @  -47,10 +47,14 @ @  let invert_tag cst tag reloc_tbl =\n              (* Argggg, ces constructeurs de ... qui commencent a 1*)\n \n let find_rectype_a env c =\n-  let (t, l) = decompose_appvect (whd_all env c) in\n-  match kind_of_term t with\n-  | Ind ind -> (ind, l)\n-  | _ -> assert false\n+  match Constr.kind c with\n+  | App (c, l) when isInd c ->\n+    (destInd c, l)\n+  | _ ->\n+    let (t, l) = decompose_appvect (whd_all env c) in\n+    match kind_of_term t with\n+    | Ind ind -> (ind, l)\n+    | _ -> assert false\n \nIt stills takes a bit of time, but this is due to rehashconsing of the term which is huge and there is no way around.\n\nMeanwhile, native_compute is slow because of OCaml algorithm of coloration of registers. The problem is not on Coq side.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552342","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552342","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552342,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjM0Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-08T18:34:43Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nSee PR https://github.com/coq/coq/pull/549 for a more general fix for the VM part.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552345","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552345","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552345,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjM0NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-08T20:01:39Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nOooh, nice.  Thanks!\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552346","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552346","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552346,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjM0Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-12T19:05:55Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\n\nShould this bug be closed?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552346/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552347","html_url":"https://github.com/coq/coq/issues/5421#issuecomment-337552347","issue_url":"https://api.github.com/repos/coq/coq/issues/5421","id":337552347,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MjM0Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-12T19:07:03Z","updated_at":"2017-10-18T10:57:48Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI think so, even though the native compute bug is not solved. But Maxime has been aware of it already so that should be OK.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337552347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]