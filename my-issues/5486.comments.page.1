[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553345","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553345","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553345,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM0NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-24T17:28:45Z","updated_at":"2018-04-17T12:53:11Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n```coq\r\nAxiom proof_admitted : False.\r\nTactic Notation \"admit\" := abstract case proof_admitted.\r\nGoal forall (T : Type) (p : prod (prod T T) bool) (Fm : Set) (f : Fm) (k : \r\nforall _ : T, Fm),\r\n    @ eq Fm\r\n        (k\r\n           match p return T with\r\n           | pair p0 swap => fst p0\r\n           end) f.\r\n  intros.\r\n  Fail match goal with\r\n       | [ |- ?f (let (a, b) := ?d in @ ?e a b) = ?rhs ]\r\n         => pose (let (a, b) := d in e a b) as t0\r\n       end. (* The command has indeed failed with message:\r\nIn environment\r\nT : Type\r\np : T * T * bool\r\nFm : Set\r\nf : Fm\r\nk : T -> Fm\r\na : T * T\r\nb : bool\r\nThe term \"a\" has type \"(T * T)%type\" while it is expected to have type \"bool\".\r\n *)\r\n  match goal with\r\n  | [ |- ?f (let (a, b) := ?d in ?e) = ?rhs ]\r\n    => pose (let (a, b) := d in e) as t\r\n  end.\r\n  Fail revert t; admit. (* The command has indeed failed with message:\r\nLtac call to \"admit\" failed.\r\nIllegal application:\r\nThe term \"@ fst\" of type \"forall A B : Type, A * B -> A\"\r\ncannot be applied to the terms\r\n \"T\" : \"Type\"\r\n \"T\" : \"Type\"\r\n \"p0\" : \"bool\"\r\nThe 3rd term has type \"bool\" which should be coercible to \"(T * T)%type\".\r\n *)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553349","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553349","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553349,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM0OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T05:40:34Z","updated_at":"2018-04-17T12:53:54Z","author_association":"CONTRIBUTOR","body":"Comment author: @silene\r\n\r\nIt has nothing to do with function application or DeBruijn indices. Here is a reduced testcase:\r\n```coq\r\nLemma foo (r : Prop * nat) : let (p, q) := r in p.\r\nmatch goal with |- let (a, b) := _ in ?c => idtac c end.\r\n(* display b, should have displayed a *)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553350","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553350","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553350,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM1MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-05-03T11:17:50Z","updated_at":"2018-04-17T12:57:19Z","author_association":"CONTRIBUTOR","body":"Comment author: @samuelgruetter\r\n\r\nJust ran into the same (or a similar) issue.\r\nHere's my testcase:\r\n\r\nIn the following pattern match on a destructuring `let`, all I do is to reconstruct the goal `G1` as `G2`, so I would expect `G1` and `G2` to be the same.\r\n\r\n```coq\r\nGoal forall (p: nat*nat), let (a, b) := p in a < b.\r\nintro p.\r\nmatch goal with\r\n| |- ?G1 =>\r\n  match G1 with\r\n  |                  (let (x1, x2) := ?c in ?body) =>\r\n    let G2 := constr:(let (x1, x2) :=  c in  body) in\r\n    assert (G1 <-> G2)\r\n  end\r\nend.\r\n```\r\nHowever, it opens the following subgoal:\r\n```coq\r\n(let (a, b) := p in a < b) <-> (let (b, a) := p in a < b)\r\n```\r\nAs you can see, a and b were swapped!\r\n\r\nInterestingly, if I use the syntax\r\n\r\n`'pair x1 x2`\r\n\r\ninstead of\r\n\r\n`(x1, x2)`\r\n\r\nit works as expected.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553351","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553351","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553351,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM1MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-05-09T21:59:35Z","updated_at":"2018-04-17T12:55:51Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\r\n\r\nFWIW, the pair and tuple versions mentioned in Comment 1 parse very differently. \r\n\r\nThe pair version:\r\n```ocaml\r\nVernacexpr.vernac_expr =\r\n  VernacSolve (SelectNth 1, None,\r\n   Tacexpr.TacMatchGoal (Tacexpr.Once, false,\r\n    [Tacexpr.Pat ([],\r\n      Tacexpr.Term\r\n       (Constrexpr.CCases ((691,715), Misctypes.LetPatternStyle, None,\r\n         [(Constrexpr.CHole ((708,709), None, Misctypes.IntroAnonymous, None),\r\n           (None, None))],\r\n         [((691,715),\r\n           [((691,715),\r\n             [Constrexpr.CPatCstr ((696,704),\r\n               Libnames.Ident ((696,700), pair), [],\r\n               [Constrexpr.CPatAtom ((701,702),\r\n                 Some (Libnames.Ident ((701,702), a)));\r\n                Constrexpr.CPatAtom ((703,704),\r\n                 Some (Libnames.Ident ((703,704), b)))])])],\r\n           Constrexpr.CEvar ((713,715), c, []))])),\r\n      Tacexpr.TacId [Tacexpr.MsgIdent ((725,726), c)])]),\r\n   false)\r\n```\r\n\r\nThe tuple version:\r\n```ocaml\r\nVernacexpr.vernac_expr =\r\n  VernacSolve (SelectNth 1, None,\r\n   Tacexpr.TacMatchGoal (Tacexpr.Once, false,\r\n    [Tacexpr.Pat ([],\r\n      Tacexpr.Term\r\n       (Constrexpr.CLetTuple ((751,771),\r\n         [((756,757), Names.Name.Name a); ((758,759), Names.Name.Name b)],\r\n         (None, None),\r\n         Constrexpr.CHole ((764,765), None, Misctypes.IntroAnonymous, None),\r\n         Constrexpr.CEvar ((769,771), c, []))),\r\n      Tacexpr.TacId [Tacexpr.MsgIdent ((781,782), c)])]),\r\n   false)\r\n```\r\n\r\nI don't know where that difference results in the different behavior.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553354","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553354","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553354,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM1NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T22:52:03Z","updated_at":"2018-04-17T12:55:21Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\r\n\r\nI may have found where the tuple gets reversed.\r\n\r\nWhen running the match_goal in Guillaume's example, in patternops.ml, `pattern_of_glob_constr', the input `c' is:\r\n```coq\r\nc: Glob_term.glob_constr = let (a, b) := _ in ?c\r\n```\r\nThe term `p' constructed by `pat_of_raw_metas [] c` is:\r\n```coq\r\np: Pattern.constr_pattern = (let (b, a) := _ in ?c)\r\n```\r\n\r\nwhich sure looks suspicious.\r\n\r\nI'll look into this tomorrow. Hooray for ocamldebug!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553355","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553355","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553355,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM1NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-05-17T16:05:50Z","updated_at":"2017-10-18T11:00:57Z","author_association":"CONTRIBUTOR","body":"Comment author: @psteckler\n\nCreated PR 641: https://github.com/coq/coq/pull/641\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553355/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553356","html_url":"https://github.com/coq/coq/issues/5486#issuecomment-337553356","issue_url":"https://api.github.com/repos/coq/coq/issues/5486","id":337553356,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU1MzM1Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-06-09T18:14:32Z","updated_at":"2017-10-18T11:00:57Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nPr 641 has been merged\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337553356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]