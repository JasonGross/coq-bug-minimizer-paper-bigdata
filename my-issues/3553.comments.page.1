[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523037","html_url":"https://github.com/coq/coq/issues/3553#issuecomment-337523037","issue_url":"https://api.github.com/repos/coq/coq/issues/3553","id":337523037,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMzAzNw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-08-29T19:46:46Z","updated_at":"2017-10-18T09:28:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 500\nLtac profiling patch for Coq 8.4\n\nIt would be nice to have built-in support for profiling Ltac.\n\nQuoting an email I sent to coqdev:\n\n\nJason Gross <jasongross9@ gmail.com>\tTue, Aug 19, 2014 at 3:33 PM\nTo: \"coqdev@ inria.fr\" <coqdev@ inria.fr>\nCc: Tobias Tebbi <ttebbi@ ps.uni-saarland.de>\nHi,\nWith [info] and debugging coming back, would it be possible to also have built-in support for profiling Ltac in 8.5?\nI've attached a patch that Tobias (cc'd) wrote for Coq 8.4, which does the profiling by hooking on to the backtrace printer.  (I've included his email describing the profiler below.)  It doesn't apply to trunk as-is, due to changes in tacinterp.ml; I'm not sure how deep this is.  Regardless, I'd love to see either enough hooks in 8.5 that this could be implemented as a plugin, or (preferably) having this functionality be bundled with Coq 8.5.\n\n-Jason\n\n\n---------- Forwarded message ----------\nFrom: Tobias Tebbi <ttebbi@ ps.uni-saarland.de>\nDate: Tue, Jul 15, 2014 at 9:09 AM\nSubject: Fwd: Ltac Profiling\nTo: Jason Gross <jasongross9@ gmail.com>\n\n\nHi Jason, \n\nHere is the Coq 8.4 patch for my profiler. It does not work in trunk, they made some changes to tacinterp.ml, but they do not seem to be fundamental, so it should be possible to adapt the patch with little effort.\n\nAll instrumentation was done without a proper understanding, so the results are possibly quite inaccurate. :D\n\nBest,\n\nTobias\n---------- Weitergeleitete Nachricht ----------\n\nVon: Tobias Tebbi <ttebbi@ ps.uni-saarland.de>\nBetreff: Ltac Profiling\nDatum: Wed, 30 Oct 2013 19:18:40 +0100\nAn: ps-m@ ps.uni-saarland.de\n\nHi,\nDuring the last days, I wrote a profiler for Ltac. It automatically\nrecords the time spend in all user-defined as well as built-in tactics\nand tactic notations. It outputs a flat profile as well as a compressed\nrecursion tree to find out where the expensive calls to tactics are\nlocated. Here is an example of the recursion tree part of the output for\nthe proof script \"aind. arew.\":\ntactic self total calls max\n────────────────────────────────────────┴──────┴──────┴───────┴─────────┘\narew ----------------------------------- 0.4% 94.1% 17 77.504s\n├─prepare ------------------------------ 0.6% 76.0% 109 5.024s\n│ ├─clean ------------------------------ 0.1% 31.3% 126 1.076s\n│ │ ├─is_trivial ----------------------- 0.2% 23.4% 2176 0.072s\n│ │ │ ├─util.clear_all ----------------- 4.9% 20.0% 2176 0.064s\n│ │ │ │ └─clear H ---------------------- 15.1% 15.1% 86748 0.016s\n│ │ │ └─done --------------------------- 0.5% 3.0% 2176 0.012s\n│ │ └─Tactics.clear_dups --------------- 6.5% 7.7% 126 0.268s\n│ ├─autoceq ---------------------------- 11.8% 23.3% 819 0.152s\n│ │ └─rewrite H in * ------------------- 10.6% 10.6% 1335 0.040s\n│ └─congruence ------------------------- 14.7% 14.7% 1322 0.032s\n└─rewrite H in * ----------------------- 4.9% 12.1% 258 1.208s\n└─params ----------------------------- 0.1% 3.1% 166 0.068s\n└─assert (Params m' v) as H by typec 0.0% 2.8% 166 0.064s\n└─typeclasses eauto -------------- 2.8% 2.8% 166 0.064s\naind ----------------------------------- 0.0% 4.6% 15 0.912s\n└─arew --------------------------------- 0.1% 3.0% 25 0.416s\nThe meaning of the columns is:\nself time spend in this tactic excluding all recorded subcalls\ntotal time spend in this tactic including the subcalls\ncalls number of times this tactic has been called\nmax maximum (total) time spent in a single invocation of the\ntactic\nIf you want to try it, you need to recompile Coq since it is a patch.\nYou can do this as follows:\n- Unpack the coq sources and cd into the created directory.\n- Patch the sources with\npatch -p1 < ltac-profiling-0.1.patch\n- Build and install coq as usual.\nThe following Vernacular commands control the profiler:\nStart Profiling. enables the profiler and resets the profile\nStop Profiling. disables the profiler\nShow Profile. prints the profile, can be seen in the *response*\nbuffer in Proofgeneral\nReset Profile. resets the profile, that is, deletes all accumulated\ninformation.\nI also added the following two tactics that behave like idtac but enable\nand disable the profiling. They allow you to exclude parts of a proof\nscript from profiling.\nstart profiling.\nstop profiling.\nI hope this is useful for some of you and I appreciate any kind of feedback!\nBest,\nTobias\n\n> Attached file: [ltac-profiling-0.1.patch](https://coq.inria.fr/bugfiles/attachment.cgi?id=500) (text/plain, 10610 bytes)\n> Description:   Ltac profiling patch for Coq 8.4\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523038","html_url":"https://github.com/coq/coq/issues/3553#issuecomment-337523038","issue_url":"https://api.github.com/repos/coq/coq/issues/3553","id":337523038,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMzAzOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T22:16:18Z","updated_at":"2017-10-18T09:28:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nWould it be possible to get this into the next pl of 8.4?\n\nIs it likely that this will make it into 8.5?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523040","html_url":"https://github.com/coq/coq/issues/3553#issuecomment-337523040","issue_url":"https://api.github.com/repos/coq/coq/issues/3553","id":337523040,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMzA0MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T05:13:48Z","updated_at":"2017-10-18T09:28:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @aspiwack\n\nNo to both question, I'm afraid. But I haven't forgotten, if I get to finish with info early (as if…), I'll review the patch and see what I can do about it.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523042","html_url":"https://github.com/coq/coq/issues/3553#issuecomment-337523042","issue_url":"https://api.github.com/repos/coq/coq/issues/3553","id":337523042,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMzA0Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-06-26T23:05:56Z","updated_at":"2017-10-18T09:28:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThis has been merged into trunk.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337523042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]