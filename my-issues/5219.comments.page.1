[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549379","html_url":"https://github.com/coq/coq/issues/5219#issuecomment-337549379","issue_url":"https://api.github.com/repos/coq/coq/issues/5219","id":337549379,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0OTM3OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-11-21T21:14:01Z","updated_at":"2017-10-18T10:47:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nHere is code that works in 8.4 and 8.5, but not 8.6:\n\nGoal forall x : sigT (fun x => x = 1), True.\n  intro x; refine match x with\n                  | existT x' e' => _\n                  end.\n  lazymatch goal with\n  | [ H : _ = _ |- _ ] => idtac\n  end. (* fails in 8.6 *)\n  progress subst. (* fails in 8.6 *)\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549381","html_url":"https://github.com/coq/coq/issues/5219#issuecomment-337549381","issue_url":"https://api.github.com/repos/coq/coq/issues/5219","id":337549381,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0OTM4MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-11-21T21:17:07Z","updated_at":"2017-10-18T10:47:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nIf this is intentional, there should probably be a compatibility option, and it \nshould be mentioned in incompatibilities.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549382","html_url":"https://github.com/coq/coq/issues/5219#issuecomment-337549382","issue_url":"https://api.github.com/repos/coq/coq/issues/5219","id":337549382,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0OTM4Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-11-22T13:41:39Z","updated_at":"2017-10-18T10:47:55Z","author_association":"CONTRIBUTOR","body":"Comment author: @herbelin\n\nHi Jason,\n\nThe implementation of \"refine\" changed radically from 8.4 to 8.5. In 8.4, it was using an ad hoc implementation based on proofs/logic.ml while in 8.5 it uses the regular type inference mechanism in pretyping.ml. In particular, there are difference in the types inferred for the hypotheses and conclusion.\n\nSome a posteriori treatments have been applied to refine in 8.5, namely global βι-reduction on _all_ hypotheses and conclusion of the goal, but this obviously introduces other unexpected side-effects.\n\nThe issue is discussed in length at https://github.com/coq/coq/pull/346.\n\nNow, if we look even more closely at the implementation than in [BZ#346](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%23346%22), one can see the difference here: In 8.4, the type of your \"e'\" is normalized by the call\nto nf_betaiota in branch Meta of Logic.mk_refgoals. On the other side, in 8.5, it is done in Cases.build_branch (via a call to Inductiveops.get_constructors) with no βι-reduction at all. So, a quick fix is to add a nf_betaiota there.\n\nNote that it would imply a change not only in refine but also in the type inference in general as visible e.g. in\n\nCheck fun x : sigT (fun x => x = 1)  => match x with  existT _ x' e' => _ end.\n\nwhich would also normalize the type of e'. But maybe that would not be so visible in general.\n\nI put such a fix for discussion at https://github.com/coq/coq/pull/373.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337549382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]