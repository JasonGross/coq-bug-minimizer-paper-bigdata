[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544454","html_url":"https://github.com/coq/coq/issues/4873#issuecomment-337544454","issue_url":"https://api.github.com/repos/coq/coq/issues/4873","id":337544454,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NDQ1NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-06-29T23:57:08Z","updated_at":"2017-10-18T10:32:10Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nHere is code that works in 8.5 and fails in trunk.\n\nRequire Import Coq.Classes.Morphisms.\nRequire Import Relation_Definitions.\nRequire Import Coq.Compat.Coq85.\n\nFixpoint tuple' T n : Type :=\n  match n with\n  | O => T\n  | S n' => (tuple' T n' * T)%type\n  end.\n\nDefinition tuple T n : Type :=\n  match n with\n  | O => unit\n  | S n' => tuple' T n'\n  end.\n\nFixpoint to_list' {T} (n:nat) {struct n} : tuple' T n -> list T :=\n  match n with\n  | 0 => fun x => (x::nil)%list\n  | S n' => fun xs : tuple' T (S n') => let (xs', x) := xs in (x :: to_list' n' xs')%list\n  end.\n\nDefinition to_list {T} (n:nat) : tuple T n -> list T :=\n  match n with\n  | 0 => fun _ => nil\n  | S n' => fun xs : tuple T (S n') => to_list' n' xs\n  end.\n\nProgram Fixpoint from_list' {T} (y:T) (n:nat) (xs:list T) : length xs = n -> tuple' T n :=\n  match n return _ with\n  | 0 =>\n    match xs return (length xs = 0 -> tuple' T 0) with\n    | nil => fun _ => y\n    | _ => _ (* impossible *)\n    end\n  | S n' =>\n    match xs return (length xs = S n' -> tuple' T (S n')) with\n    | cons x xs' => fun _ => (from_list' x n' xs' _, y)\n    | _ => _ (* impossible *)\n    end\n  end.\nGoal True.\n  pose from_list'_obligation_3 as e.\n  repeat (let e' := fresh in\n          rename e into e';\n          (pose (e' nat) as e || pose (e' 0) as e || pose (e' nil) as e || pose (e' eq_refl) as e);\n          subst e').\n  progress hnf in e.\n  pose (eq_refl : e = eq_refl).\n\n\n\n\nHere's more code that works in 8.5 and fails in trunk, which I expect to keep working in trunk.\n\nRequire Import Coq.Classes.Morphisms.\nRequire Import Relation_Definitions.\nRequire Import Coq.Compat.Coq85.\n\nFixpoint tuple' T n : Type :=\n  match n with\n  | O => T\n  | S n' => (tuple' T n' * T)%type\n  end.\n\nDefinition tuple T n : Type :=\n  match n with\n  | O => unit\n  | S n' => tuple' T n'\n  end.\n\nFixpoint to_list' {T} (n:nat) {struct n} : tuple' T n -> list T :=\n  match n with\n  | 0 => fun x => (x::nil)%list\n  | S n' => fun xs : tuple' T (S n') => let (xs', x) := xs in (x :: to_list' n' xs')%list\n  end.\n\nDefinition to_list {T} (n:nat) : tuple T n -> list T :=\n  match n with\n  | 0 => fun _ => nil\n  | S n' => fun xs : tuple T (S n') => to_list' n' xs\n  end.\n\nProgram Fixpoint from_list' {T} (y:T) (n:nat) (xs:list T) : length xs = n -> tuple' T n :=\n  match n return _ with\n  | 0 =>\n    match xs return (length xs = 0 -> tuple' T 0) with\n    | nil => fun _ => y\n    | _ => _ (* impossible *)\n    end\n  | S n' =>\n    match xs return (length xs = S n' -> tuple' T (S n')) with\n    | cons x xs' => fun _ => (from_list' x n' xs' _, y)\n    | _ => _ (* impossible *)\n    end\n  end.\n\nProgram Definition from_list {T} (n:nat) (xs:list T) : length xs = n -> tuple T n :=\nmatch n return _ with\n| 0 =>\n    match xs return (length xs = 0 -> tuple T 0) with\n    | nil => fun _ : 0 = 0 => tt\n    | _ => _ (* impossible *)\n    end\n| S n' =>\n    match xs return (length xs = S n' -> tuple T (S n')) with\n    | cons x xs' => fun _ => from_list' x n' xs' _\n    | _ => _ (* impossible *)\n    end\nend.\n\nLemma to_list_from_list : forall {T} (n:nat) (xs:list T) pf, to_list n (from_list n xs pf) = xs.\nProof.\n  destruct xs; simpl; intros; subst; auto.\n  generalize dependent t. simpl in *.\n  induction xs; simpl in *; intros; congruence.\nQed.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544454/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544455","html_url":"https://github.com/coq/coq/issues/4873#issuecomment-337544455","issue_url":"https://api.github.com/repos/coq/coq/issues/4873","id":337544455,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NDQ1NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-07-07T13:34:39Z","updated_at":"2017-10-18T10:32:10Z","author_association":"CONTRIBUTOR","body":"Comment author: @mattam82\n\nHi, the bug has been fixed in the v8.6 branch (and will be merged back on trunk).\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544456","html_url":"https://github.com/coq/coq/issues/4873#issuecomment-337544456","issue_url":"https://api.github.com/repos/coq/coq/issues/4873","id":337544456,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0NDQ1Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-07-07T15:47:35Z","updated_at":"2017-10-18T10:32:10Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nThanks!\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337544456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]