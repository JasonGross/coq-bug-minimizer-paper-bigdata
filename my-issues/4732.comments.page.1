[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542425","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542425","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542425,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQyNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T20:13:02Z","updated_at":"2017-11-06T02:20:03Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nI expect `let tac := <some tactic expression> in do stuff; tac` to evaluate any `match`es and `let`s in the tactic expression, to make it a tactic, and then do stuff, and then run the tactic.  Instead, it seems to semi-unpredictably sometimes decide to fully execute the tactic expression before doing stuff:\r\n\r\n```coq\r\nGoal True /\\ False.\r\nsplit.\r\nall:let tac := (idtac \"now\"; let n := numgoals in idtac n; match goal with |- ?G => idtac G end) in\r\n    idtac \"before\";\r\n    tac;\r\n      exfalso;\r\n      tac. (* before now 2 True False now 2 False False *)\r\nUndo.\r\nall:let tac := match constr:(Set) with\r\n               | _ => idtac \"now\"; let n := numgoals in idtac n; match goal with |- ?G => idtac G end\r\n               end in\r\n    idtac \"before\";\r\n    tac; exfalso; tac. (* now 1 True now 1 False before before *)\r\n```\r\n\r\nIs this intended?  If so, why?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542427","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542427","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542427,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQyNw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T21:48:35Z","updated_at":"2017-11-06T02:20:27Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nHere is code that works in 8.4, but breaks in 8.5.  The 8.4 behaviour of evaluating `lazymatch` at the time of tactic invocation was already confusing to newcomers (see, e.g., bug [BZ#3498](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%233498%22)).  The fact that Ltac will now (sometimes) evaluate entire tactics (including things like `pose` and `assert`) at argument-passing time rather than at invocation time seems significantly worse.\r\n\r\n```coq\r\nAxiom admit : forall {T}, T.\r\nLtac foo := lazymatch constr:(Set) with\r\n            | _ => assert False by exact admit\r\n            end.\r\n\r\nLtac mydo tac := clear; tac.\r\n\r\nGoal False.\r\n  mydo foo.\r\n  assumption.\r\nQed.\r\n```","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542428","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542428","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542428,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQyOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T14:43:18Z","updated_at":"2017-10-18T10:25:35Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThere are two separate issues there, i.e. one for match and the other for lazymatch.\n\nThe first one is the semantics of \"match\". If I understand correctly the implementation, the fact that \"match\" forces entirely its return clause is not a bug, but a feature inserted here to preserve compatibility with 8.4.\n\nAs for lazymatch, I can't tell. I honestly have never understood its pre-8.5 semantics.\n\nRegarding the bugfix, there is no miracle solution here: we need to stick to a proper calling convention. It even happens that I wrote a surprisingly small patch that makes Ltac call-by-value. But that breaks about everything...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542429","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542429","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542429,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQyOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T16:02:15Z","updated_at":"2017-11-06T02:23:08Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nEwwwwww...  Okay, having reread Arnaud's email from 2014-12-31, let me try again to explain my understanding of Ltac semantics in 8.4:\r\n\r\nLtac has two languages, and two phases: a tactic expression language, and a tactic language.  All tactic expressions evaluate to tactics, tactic functions, constrs, or integers.\r\n\r\nIn the tactic evaluation phase, tactics (`pose`, `;`, `repeat`, etc) are run.\r\n\r\nIn tactic expression evaluation phase, the following things happen:\r\n- `let name := <expr> in <body>` ~~~> evaluate `<expr>` as an expression, substitute the result in `<body>`, evaluate `<body>` as an expression; if at any point in the evaluation we hit a `match ... with ... end` that evaluates to a tactic rather than a constr or an integer, raise \"Immediate match producing tactics not allowed in local definitions\"\r\n- `<tactic function expr> <args exprs>` ~~~> evaluate all exprs as tactic expressions; if any of the arguments evaluate to `match ... with ... end`, raise \"Immediate match producing tactics not allowed in local definitions.\"\r\n- `constr:(<expr>)` evaluate `<expr>` as a constr; raise a failure if, e.g., not all holes are filled, the term does not type, etc.\r\n- `lazymatch ... with ... end` ~~~> evaluate the `match`: for each matched branch, evaluate the branch as an expression; backtrack across failures in expression evaluation (e.g., if one branch evaluates to `constr:(I : I)`, backtrack)\r\n- `match ... with ... end` ~~~> evaluate the `match`: for each matched branch, evaluate the branch as an expression, ***and then evaluate the result in the tactic evaluation phase***\r\n\r\n\r\nNow, the fact that `match` is effectively a construct that forces tactics to be *run* eagerly was hidden from the user in all but the edge cases, where a failing [match] showed up inside a `lazymatch` which was not in a local definition.  I think the intended semantics was that constr-returning `match`es should be evaluated during tactic expression evaluation, and tactic-returning `match`es should be evaluated only during tactic running time.\r\n\r\nIn 8.5, this is much more apparent the the user: the error message has been removed, and `match` forces its tactic evaluation to happen in the tactic expression evaluation phase.\r\n\r\nIn some ways this is useful.  Here is something that you needed typeclasses to do in 8.4, which you can now do in 8.5, even without tactics in terms:\r\n```coq\r\nLtac constr_idtac msg :=\r\n  let dummy := match constr:(Set) with\r\n               | _ => idtac msg\r\n               end in\r\n  constr:(Set).\r\n\r\nGoal True.\r\n  let v := constr_idtac Set in\r\n  pose v.\r\n```\r\n\r\nAnd here is a reimplementation of the part of tactics in terms that lets you switch back and forth between constructing constrs in Ltac-land and running tactics (except it mangles the proof tree):\r\n\r\n```coq\r\nLtac as_term tac :=\r\n  let k := fresh in\r\n  let dummy := lazymatch goal with\r\n               | _ => simple refine (let k := _ in _); [ | tac | ]; []\r\n               end in\r\n  let value := (eval unfold k in k) in\r\n  let dummy := lazymatch goal with\r\n               | _ => clear k\r\n               end in\r\n  value.\r\n\r\nGoal True.\r\n  let t := as_term ltac:(refine (_ : True); abstract exact I) in\r\n  pose t.\r\n  exact I.\r\nQed.\r\n```\r\n\r\n\r\nSo this is useful, but it seems to be a rather large departure from the 8.4 semantics, where you could never inject tactic running into the tactic expression evaluation phase.  Here's an example of how lazymatch has genuinely changed semantics:\r\n\r\n```coq\r\nGoal True.\r\n  let tac := lazymatch goal with\r\n        |- ?G => idtac G; match goal with\r\n                            |- ?G => idtac G \r\n                          end\r\n      end in\r\n  exfalso; idtac \"a\"; tac.\r\n\r\n(* 8.4: a True False *)\r\n(* 8.5: True True a *)\r\n```\r\n\r\nThis means I can no longer use `lazymatch` to choose which tactic to run later, since it forces its branches early.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542432","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542432","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542432,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQzMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T16:55:08Z","updated_at":"2017-10-18T10:25:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @jonleivent\n\nJason: use \"let rec\":\n\nGoal True.\n  let rec tac := lazymatch goal with\n        |- ?G => idtac G; match goal with\n                            |- ?G => idtac G \n                          end\n      end in\n  exfalso; idtac \"a\"; tac.\n\nI believe this works the same in 8.5 as 8.4.\n\nThe semantics is very confusing to novices - there have been several occurrences of confusion on Coq club that amounts to this evaluation time situation.\n\nPersonally, I think having a dedicated syntactic way (not piggy-backed on some uses of the match family of tacticals) to specify time of evaluation would be less confusing and more useful.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542433","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542433","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542433,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQzMw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T17:00:35Z","updated_at":"2017-11-06T02:23:31Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nJonathan: let rec has the wrong behavior; it's equivalent to prefixing the tactic with `idtac; `.  I want a way to evaluate the `match` early, but evaluate the tactic late.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542435","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542435","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542435,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQzNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T17:01:36Z","updated_at":"2017-10-18T10:25:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nWhy don't you use thunks just as in any good language? Like so:\n\nlet tac := match foo with _ => fun _ => expr end in ... tac () ...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542438","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542438","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542438,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQzOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T17:13:03Z","updated_at":"2017-10-18T10:25:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @jonleivent\n\nSorry about my confusion, Jason.  I agree with PMP:\n\nGoal True.\n  let tac := lazymatch goal with\n        |- ?G => fun _ => idtac G; match goal with\n                            |- ?G => idtac G \n                          end\n      end in\n  exfalso; idtac \"a\"; tac ().\n\nproduces in 8.5pl1:\na\nTrue\nFalse\n\nAnd, if you don't like the extra arg, you can mask it out with a second let:\n\nGoal True.\n  let tac' := lazymatch goal with\n        |- ?G => fun _ => idtac G; match goal with\n                            |- ?G => idtac G \n                          end\n      end in\n  let tac := idtac; tac' () in\n  exfalso; idtac \"a\"; tac.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542439","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542439","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542439,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQzOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T17:14:15Z","updated_at":"2017-10-18T10:25:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nIf I were you, I would rather stick to the thunk-based approach. This will be less painful for you when Ltac turns CBV.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542440","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542440","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542440,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T17:58:09Z","updated_at":"2017-10-18T10:25:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @jonleivent\n\nPMP: when is Ltac turning CBV?  Is that part of the 8.6 plan?\n\nI think I have managed to avoid any dependency on early evaluation of matches, believing that early evaluation aspect of Ltac to perhaps be most vulnerable to change (after all, most tactics don't evaluate to anything useful, it's their side effects that are useful).  But, you are instead saying that I will need to thunk all otherwise-arg-less tactics in 8.6?  Will there be a syntactic way to specify call-by-name semantics for certain args?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542441","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542441","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542441,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T18:02:03Z","updated_at":"2017-10-18T10:25:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nLtac won't turn CBV overnight, don't worry! And in particular it definitely won't be in 8.6. But on the (not-so) long term, I hope it will indeed. There are various upgrade paths possible, ranging from backward compatibility flags to a brand new language with the old Ltac as a legacy plugin.\n\nThe only thing we know for sure is that the current Ltac language is a real crap, both in terms of semantics and expressiveness, so that it is unavoidable that it has to change...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542442","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542442","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542442,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T18:31:15Z","updated_at":"2017-11-06T02:23:49Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\r\n\r\nThunking doesn't fix my other problem, which is that `match constr:(...) with ... end` focuses, when I don't believe it should.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542443","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542443","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542443,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T18:35:48Z","updated_at":"2017-10-18T10:25:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n(In reply to Jason Gross from comment [BZ#11](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%2311%22))\n> Thunking doesn't fix my other problem, which is that [match constr:(...)\n> with ... end] focuses, when I don't believe it should.\n\nIt is necessary for match to focus, because the term being matched on is interpreted in the environment of a goal. There is no workaround AFAIK, apart maybe by creating a dummy goal...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542443/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542444","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542444","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542444,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T18:58:16Z","updated_at":"2017-10-18T10:25:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @jonleivent\n\nIMHO the global/local focus problem in Ltac is very big, not merely limited to which tactics/tacticals force local focus and which don't, and when.  Although that is a big part of it.  I've come to think the whole global/local concept is broken (see 3878).  I have been playing with a replacement - see 4468.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542446","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542446","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542446,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T19:04:27Z","updated_at":"2017-10-18T10:25:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nWhile I agree that your feature proposal in bug [BZ#4468](https://github.com/coq/coq/issues?q=is%3Aissue%20%22Original%20bug%20ID%3A%20BZ%234468%22) would provide a more robust alternative to the current goal manipulation mechanism, it does not solve a deeply rooted issue in Ltac semantics, namely, determining the scope in which an object is interpreted. What do yo do when you encounter an expression of the form \"let x := constr:(foo) in tac\"? This has nothing to do with goal manipulation per se...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542446/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542448","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542448","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542448,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ0OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-16T19:22:39Z","updated_at":"2017-10-18T10:25:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @jonleivent\n\nI have a somewhat working example of the meta-goal idea from 4468, and it includes a potential solution to \"let x := constr:(foo) in tac\".  The whole implementation I have so far is heavily based on hacking the instantiate tactic - but it is just serving as a proof of concept, as one would rather have the capability built in than rely on tactic hacks.  Still, the solution is that a uconstr can be evaluated to a constr in any particular target goal (which the meta goal sees as a local def hypothesis) from the meta goal using the instantiate tactic, it's value posed in that goal so it becomes part of the corresponding evar's type, and read out from that type by the meta goal.  Hence, from a single goal's local focus (the meta goal), and while maintaining just that focus, one can evaluate constrs or perform actions in any of the other goals.  A built-in meta-goal solution would perhaps have some construct like \"let x := constr:(foo):ingoal(G1) in tac\" so as to avoid the rigamarole, where the \":ingoal(G1)\" part would only work in meta goals (or maybe it would take any evar as its arg and work in any goal).\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542450","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542450","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542450,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ1MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-05-17T17:57:44Z","updated_at":"2017-10-18T10:25:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @aspiwack\n\n> It even happens that I wrote a surprisingly small patch that makes\n> Ltac call-by-value. But that breaks about everything...\n\nThis is less that I would have expected ;-) .\n\nMore seriously…\n\nThe main « problem » with `match` and `lazymatch` is that they can not only return a tactic but also other kinds of values such as numbers and terms. Better: they can return tactics in some branches and values in others, such as:\n\n    match H with\n    | True => fail \"Truth is relative\"\n    | _ => constr:H\n    end\n\nIn v⩽8.4, `lazymatch` tried to recognize whether a branch was to be evaluated or not depending on whether it was a tactic or something else. But no one will be surprised, I assume, when I tell them that it didn't quite work as expected.\n\nI don't know a way to fix the crazy behaviour of v⩽8.4 `lazymatch` (which could be converted into a non-lazy `match` with the proper application of clever branches (which has happened by accident to some)) without having a more sane always-by-value semantics for the branches.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542451","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542451","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542451,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ1MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-06-26T23:18:59Z","updated_at":"2017-10-18T10:25:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nSo this one is a WONTFIX, I believe?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542453","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-337542453","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":337542453,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzU0MjQ1Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-09-27T08:04:27Z","updated_at":"2017-10-18T10:25:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @bluelightning32\n\nI hit this same bug.\n\nIf nothing else, the documentation should be updated. It implies that tactics cannot be not evaluated in let expressions,\n\n\"If expr1 evaluates to a tactic and the match expression is in position to be applied to a goal (e.g. it is not bound to a variable by a let in), then this tactic is applied. If the tactic succeeds, the list of resulting subgoals is the result of the match expression. If expr1 does not evaluate to a tactic or if the match expression is not in position to be applied to a goal, then the result of the evaluation of expr1 is the result of the match expression.\"\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337542453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/807262943","html_url":"https://github.com/coq/coq/issues/4732#issuecomment-807262943","issue_url":"https://api.github.com/repos/coq/coq/issues/4732","id":807262943,"node_id":"MDEyOklzc3VlQ29tbWVudDgwNzI2Mjk0Mw==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2021-03-25T18:42:24Z","updated_at":"2021-03-25T18:42:24Z","author_association":"MEMBER","body":"See also https://github.com/coq/coq/pull/12103#discussion_r423382531","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/807262943/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]