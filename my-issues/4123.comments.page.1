[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532791","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532791","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532791,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjc5MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-12T21:41:57Z","updated_at":"2017-10-18T09:56:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCompiling all of bedrock (about 415 .v files, 3.9 MB) in 8.4pl5 gives me 2.0 GB of .vo files, the largest of which is 72 MB.  There are only 8 .vo files larger than 40 MB.\n\nCompiling half of bedrock (249 files) in -quick mode in 8.5 already totals 6.7 GB of .vio files, the largest of which is 94 MB.  92 are larger than 40 MB, 61 of which are larger than 60 MB.  I am running out of harddrive space, and have already consolidated the multiple copies of bedrock lying around.  It would be nice if (and seems theoretically possible that) the .vio files could be not much larger than the size of the .vo file + the size of the .v file.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532791/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532792","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532792","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532792,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjc5Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-12T22:13:20Z","updated_at":"2017-10-18T09:56:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nWhile you are at it, would you be kind enough to give benchmarks too (timings).\n\n2G vs 14G (extrapolating)\n\nI'm sorry it is bigger, but it is not *huge* (my smatphone has enough storage to hold these .vio files).  A .vio is not optimized for space at all, but it is hard today to find on the market an hard drive smaller than 256G... and Bedrock is big... If PMP is listening, do you still have your \"marshaled data compaction utility\" at hand (to see the theoretical optimum of the current approach)?\n\nIn any case you have to measure the memory usage of Coq /while/ producing .vo\nfiles and the .vio files, since a .vio is a \"dump\" of the state of Coq,\nnot of the resulting .vo file, + the AST of the .v file.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532794","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532794","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532794,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjc5NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-12T22:31:54Z","updated_at":"2017-10-18T09:56:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nThe benchmarks I could give you now would be confused, because I'm on a networked filesystem.  For example:\n  Bedrock/Platform/Cito/PostOk (real: 85.28, user: 12.92, sys: 47.16, mem: 4360288 ko)\n\nRelatedly, my quota on this filesystem is under 20 GB, which is why I'm hitting issues... but my ~256 GB local drive also has only 13 GB free, and it is a continual struggle to keep enough space free to, e.g., run a VM.\n\nI hope to have most of the non-proofy parts of bedrock compiling within the next few days, and have a Jenkins instance doing this automatically; once I get this set up, I'll point you at the logs from the Jenkins instance (or copy them for you, if we can't get permissions set up).\n\nI will note that there is one file in bedrock that, in 8.4pl5, requires around 11 GB RAM to produce the .vo file.  Everything else (before and after it) works fine with 8GB RAM and 1GB swap.\n\n\nMy suggestion could be taken to say that it might be nice if it could instead be a dump of the AST + the .vo file + whatever interpolation data is needed, since this seems to be much smaller than the state of Coq.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532795","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532795","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532795,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjc5NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T04:31:40Z","updated_at":"2017-10-18T09:56:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\n> 2G vs 14G (extrapolating)\n\nYou are underestimating.  At 348 / 412, I've already hit 15 GB, with 3 files over 300 MB, 7 files over 200 MB, and 13 over 100 MB.  If things keep growing like this, say an average of 200 MB (though I wouldn't be surprised if the average gets up to 400 MB) for the remaining files (do .vio files include everything that's [Require]d into them, or something?), that could be a total of around 30 GB.  Even for a project like bedrock, I feel like this is unreasonably large.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532798","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532798","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532798,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjc5OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T14:10:01Z","updated_at":"2017-10-18T09:56:36Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nNote: it seems that I can cut the .vio file size in ~half by passing -no-native-compiler.  Why should the native compiler contribute so much?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532798/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532800","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532800","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532800,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T14:24:35Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @maximedenes\n\nWow, sounds surprising! But I must confess I haven't followed what exactly goes into .vio files.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532802","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532802","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532802,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T14:49:46Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\n> Note: it seems that I can cut the .vio file size in ~half by passing -no-native-compiler.  Why should the native compiler contribute so much?\n\nSorry, strike that, this is probably not the case; I am just bad at counting file size.  (Trouble with symlinks.)\n\nCurrently at 379/412, and 17 GB.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532803","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532803","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532803,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwMw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T15:50:26Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nFTR, a .vio file contains a dump of the Summary.  If you never used such API for the native compiler, than it can't have an impact.  Unless, you add data to data structures already in the summary, like the env.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532805","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532805","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532805,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T16:50:07Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n\n> I'm sorry it is bigger, but it is not *huge* (my smatphone has enough\n> storage to hold these .vio files).  A .vio is not optimized for space at\n> all, but it is hard today to find on the market an hard drive smaller than\n> 256G... and Bedrock is big... If PMP is listening, do you still have your\n> \"marshaled data compaction utility\" at hand (to see the theoretical optimum\n> of the current approach)?\n\nThe code is there: https://github.com/ppedrot/ocaml-compactor. It may need a little bit of adaptation to handle well the vio structure, but that should be rather easy.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532806","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532806","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532806,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-14T12:54:53Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThe compactor was updated to handle the vio structure. Jason, can you try it on one of your huge files to see what happens? (I believe you'll hit performance issues, but I can try to get around this).\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532807","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532807","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532807,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwNw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T03:27:03Z","updated_at":"2017-10-18T09:56:37Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nI assume I'm supposed to `make opt`, not `make`?  `make` gives me:\n\n$ make\nocamldep partition.ml hopcroft.ml analyze.ml dot.ml compact.ml main.ml > .deps\nocamlopt -g -c partition.ml\nFile \"partition.ml\", line 1:\nError: Could not find the .cmi file for interface partition.mli.\nmake: *** [partition.cmx] Error 2\n\n\nHow long should I expect it to take?  I'm currently trying it on the biggest bedrock .vio file (367MB) (total is 18 GB for ~everything).  The .vio is available, for now, at http://people.csail.mit.edu/jgross/tmp/CountUnique.vio.  I suppose I shall just leave compact running on it overnight.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532808","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532808","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532808,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgwOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T03:55:35Z","updated_at":"2017-10-18T09:56:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nThe compactor takes > 8 GB RAM; it was killed:\n\njgross@ cagnode13:~/ocaml-compactor$ ls -la CountUnique.vio\n-rw-rw-r-- 1 jgross jgross 384132458 Mar 14 23:17 CountUnique.vio\njgross@ cagnode13:~/ocaml-compactor$ time ./compact CountUnique.vio\nKilled\n\nreal    21m23.899s\nuser    2m47.150s\nsys     0m22.525s\n\n\nI'll try it on a smaller .vio file.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532810","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532810","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532810,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T04:06:02Z","updated_at":"2017-10-18T09:56:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nOn a 100K file (compacted to 75K):\n\njgross@ cagnode13:~/ocaml-compactor$ ls -la NotationExample.vio\n-rw-rw-r-- 1 jgross jgross 101577 Mar 14 23:57 NotationExample.vio\njgross@ cagnode13:~/ocaml-compactor$ time ./compact NotationExample.vio\n\nreal    0m0.116s\nuser    0m0.092s\nsys     0m0.016s\njgross@ cagnode13:~/ocaml-compactor$ ls -la NotationExample.vio\n-rw-rw-r-- 1 jgross jgross 76785 Mar 14 23:57 NotationExample.vio\n\nOn a 1M file (compacted to 408K):\n\njgross@ cagnode13:~/ocaml-compactor$ ls -la StringSetFacts.vio\n-rw-rw-r-- 1 jgross jgross 1092069 Mar 14 23:58 StringSetFacts.vio\njgross@ cagnode13:~/ocaml-compactor$ time ./compact StringSetFacts.vio\n\nreal    0m1.925s\nuser    0m1.816s\nsys     0m0.088s\njgross@ cagnode13:~/ocaml-compactor$ ls -la StringSetFacts.vio\n-rw-rw-r-- 1 jgross jgross 417062 Mar 14 23:58 StringSetFacts.vio\n\n\nOn a 16M file (compacted to 6.6M):\n\njgross@ cagnode13:~/ocaml-compactor$ ls -la Folds.vio\n-rw-rw-r-- 1 jgross jgross 16753312 Mar 14 23:58 Folds.vio\njgross@ cagnode13:~/ocaml-compactor$ time ./compact Folds.vio\n\nreal    0m48.483s\nuser    0m46.451s\nsys     0m1.484s\njgross@ cagnode13:~/ocaml-compactor$ ls -la Folds.vio\n-rw-rw-r-- 1 jgross jgross 6835054 Mar 14 23:59 Folds.vio\n\nOn a 90M file.... I'll let you know when it finishes.\n\n\nBy the way, Enrico, I can't give you a timing log yet; the Jenkins setup I'm using seems to be a VM with less than 18 GB free; it runs out of space when trying to `make quick` for bedrock.  But if you want to run the times yourself, https://github.com/JasonGross/bedrock/tree/trunk should build everything with `make quick TIMED=1 -kj` (faster if you pass OTHERFLAGS=-no-native-compiler), modulo ~5 files at the very end that use extraction (which seems to diverge on `Unset Extraction AccessOpaque.  Recursive Extraction ...` in -quick mode, maybe?)\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532812","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532812","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532812,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T04:33:43Z","updated_at":"2017-10-18T09:56:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nI killed the 90M one after 17 minutes, when I noticed it ate 7-8 GB RAM.\n\nOn a 51M file (compacted to 18M):\njgross@ cagnode13:~/ocaml-compactor$ ls -la SemanticsFacts8.vio\n-rw-rw-r-- 1 jgross jgross 52661926 Mar 15 00:19 SemanticsFacts8.vio\njgross@ cagnode13:~/ocaml-compactor$ time ./compact SemanticsFacts8.vio\n\nreal    2m40.762s\nuser    2m33.050s\nsys     0m4.128s\njgross@ cagnode13:~/ocaml-compactor$ ls -la SemanticsFacts8.vio\n-rw-rw-r-- 1 jgross jgross 18220563 Mar 15 00:23 SemanticsFacts8.vio\n\n\nFor reference, the size comparison table on this small selection:\n\nname            | .v   | .vo  | .vio | .vio (compacted)\n-------------------------------------------------------\nNotationExample | 2K   | 58K  | 100K | 75K\nStringSetFacts  | 0.4K | 2M   | 1.1M | 408K\nFolds           | 5K   | 40K  | 16M  | 6.6M\nSemanticsFacts8 | 11K  | 104K | 51M  | 18M\n\nSo the compactification seems pretty useful (factor of ~2.5 smaller), except for when it eats up all my RAM and time.  But the .vio files are still vastly bigger than the corresponding .vo files in many cases.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532814","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532814","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532814,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxNA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T10:41:29Z","updated_at":"2017-10-18T09:56:38Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThe compactor is assumed to be in O(n log n) time and O(n) space, but the size of the objects we're considering pushes it indeed to its limits.\n\nI have tried it on an ssreflect vio (the ~50 Mio ssralg.vio to be precise) and I also observe the 2.5 factor, and several orders of magnitude w.r.t. the vo.\n\nThis means that there is still a lot of stuff in the vio. Maybe we can modify the votour program to give us an idea of who is taking so much space?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532816","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532816","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532816,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T11:16:54Z","updated_at":"2017-10-18T09:56:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nTo me this 2.5 factor means that the code of Coq loses some theoretically possible sharing.  But for a 2x factor it does not seem worth to investigate.\n\nA .vio contains a dump of the summary per proof task (hopefully sharing parts of their content).\n\nvotour can hardly be extended to look inside the summary in an easy way.\nThe way the state of the system (summary) is organized is pretty much anarchic, each module can add to it pretty much anything, and we don't have the data type description (as we have for the rest of the .vo file contents).\nTo me the best way to investigate the issue is to instrument the code that dumps the summary to print the size and label of each component.  Then see why the big chunks are so big.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532816/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532818","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532818","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532818,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T11:17:30Z","updated_at":"2017-10-18T09:56:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nAh, I forgot.  Thanks jason for running the compaction tests!\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532818/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532819","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532819","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532819,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgxOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T19:11:55Z","updated_at":"2017-10-18T09:56:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n\n> votour can hardly be extended to look inside the summary in an easy way.\n> The way the state of the system (summary) is organized is pretty much\n> anarchic, each module can add to it pretty much anything, and we don't have\n> the data type description (as we have for the rest of the .vo file contents).\n\nYes and no. I have been thinking for quite a time to add an optional debug segment in the vo files, including amongst others the data structure of Dyn.t objects. This would allow several things, for instance a coqobjinfo program spitting out details about the vo, similarly to ocamlobjinfo.\n\nThere aren't that many distinct dynamic objects defined in the Coq stack (a quick grep gives me a bit more than 60), so I do not think that this task would be daunting.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532820","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532820","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532820,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgyMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-15T20:16:35Z","updated_at":"2017-10-18T09:56:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI am currently looking at the contents of vio using votour. Is is normal that in the STM task segment, the majority of the memory is taken by the document of the first task? The first document eats up 5M words, while the remaining only accounts for 2.5M words...\n\nI do not understand very well the internals of the vio processing. Do tasks only store the diffs of the state between them?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532821","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532821","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532821,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgyMQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-16T10:32:50Z","updated_at":"2017-10-18T09:56:39Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nHere is a more fine-grained analysis of an uncompressed ssarg.vio. I believe it represents well the standard situation of a vio. Below, MW stands for 10⁶ words.\n\nWhole file: 18MW\n\nFirst object: 13MW, of which\n\n1. LIBRARY-SUMMARY 8MW\n2. MODULE-SUBSTOBJS-SUMMARY 2.5MW\n3. names-SUMMARY 1MW\n\nThe next object by size is very far in the list of task, and only accounts for 0.5MW.\n\nClearly, the issue comes from the fact that the vio embeds ALL of the libraries required so far. This leads to a quadratic behaviour, which explaines the explosion Jason observes on a file-plentiful development such as Bedrock.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532825","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532825","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532825,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgyNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-17T14:50:25Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nJason, can you try to build Bedrock with that branch?\n\nhttps://github.com/ppedrot/coq/tree/require-on-the-fly\n\nInstead of storing the whole library in the vio, it just keeps an index into the relevant file. It is not miraculous, but I get a ~25% size gain on reasonable sizes of vio files, and I secretly hopes it partially counters the linear growth of vio files.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532826","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532826","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532826,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgyNg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:32:15Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 564\nSizes of .vio files with require-on-the-fly\n\nI've built Bedrock with require-on-the-fly, and it seems to have made the big files a little smaller (the biggest is down from 376MB to 346MB), and the smaller files a little bigger (NotationExample is up from 100K to 119K), and overall the size is now 19GB (negligible change).  The full log of current sizes (with require-on-the-fly) is attached.  Many of the .vio files are currently available at http://people.csail.mit.edu/jgross/tmp/bedrock-vio/, I believe, but may not be for long.  If you want any of the .vio files to explore, I can give them to you.\n\n> Attached file: [bedrock-vio-size.log.txt](https://coq.inria.fr/bugfiles/attachment.cgi?id=564) (text/plain, 33746 bytes)\n> Description:   Sizes of .vio files with require-on-the-fly\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532828","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532828","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532828,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgyOA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:34:49Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nCreated attachment 565\nLog of building .vio files for bedrock\n\nEnrico, here is a log of the build on AFS (a networked file system).  I'm afraid it's not the best quality log; the first large chunk is with the native compiler, while the rest is with the native compiler disabled, and the real/system times are noisy due to networked file system access.  But was this log something like what you were looking for?\n\n> Attached file: [bedrock-vio.log.txt](https://coq.inria.fr/bugfiles/attachment.cgi?id=565) (text/plain, 65967 bytes)\n> Description:   Log of building .vio files for bedrock\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532830","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532830","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532830,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgzMA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:44:06Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nMeh. I'm disappointed. Thanks anyway, Jason.\n\nI've been crawling through some ssreflect vios to have an idea of the fat objects down there. There are two recurring object kinds worthy to mention.\n\n1. Declarations.module_signature\n2. Cemitcodes.to_patch\n\nThe first one is by far the most represented one in the dumps. I assume this is due to the fact we consider expanded signatures for functors, so that functor applications trigger some form of combinatorial explosion. For the second one, I do not have a precise understanding, but the patch list becomes huge in some cases (around 3000 elements), a phenomenon I can't explain at all.\n\nIn any case, it seems that the vio file is bound to be linear in the size of the session, resulting in the aforementioned quadratic explosion when considering all files. Otherwise said, if X.vio depends on Y.vio, then X size is at least of the order of Y size.\n\nMaybe one could work around this by providing blocks of vio files to ensure more sharing?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532832","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532832","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532832,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgzMg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:58:07Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nBedrock does make heavy use of modules and functors, so I could see that being relevant.\n\nWhat are Cemitcodes?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532833","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532833","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532833,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgzMw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:59:26Z","updated_at":"2017-10-18T09:56:40Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nThey are the code produced by the VM.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532835","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532835","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532835,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgzNQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T18:59:40Z","updated_at":"2017-10-18T09:56:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @maximedenes\n\nThe usual suspects...\n\nTwo remarks about the Cemitcodes.to_patch objects (they are used by the VM):\n\n1) We should ask Benjamin Grégoire if he sees what's happening.\n\n2) The two explosions could be related, since Cemitcodes.to_patch handles relocation of constants after functor instantiation, if I recall correctly.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532839","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532839","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532839,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjgzOQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T19:26:16Z","updated_at":"2017-10-18T09:56:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nJust for the record: I looked at some vio files provided by Jason, and once again most of the size is due to module_signature objects.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532840","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532840","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532840,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg0MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T12:56:57Z","updated_at":"2017-10-18T09:56:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nI take the freedom to add the experience of Arthur to this bug report.\n\nHere are some stats for TLC:\n========================\ncharguer@ charg:~/tlc/src$ du -hc *.vo\n4.6M    total\ncharguer@ charg:~/tlc/src$ du -hc *.vio\n710M    total\n========================\nThen I used a regexp to remove all proofs in \"Proof using. (..) Qed.\", simply\nreplacing them by \"Proof using. Admitted\".\n========================\ncharguer@ charg:~/tlc/src$ du -hc *.vo\n3.1M    total\ncharguer@ charg:~/tlc/src_test$ du -hc *.vio\n57M    total\n========================\n\nThis is very odd to me.  If Arthur has time, I ask to turn\nthe proofs into \"Proof using. idtac. Admitted.\" in a recent Coq\nversion (where Admitted proofs are processed asynchronously, it\nis not the case in beta1 for example).\n\nIf the 20x factor stays, then there must be something very fishy.\nThe \"AST\" of tactics can't be the reason for that.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532840/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532841","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532841","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532841,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg0MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T13:45:03Z","updated_at":"2017-10-18T09:56:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @charguer\n\nI ran with  \"Proof using. idtac. Admitted\".\nit gave the same results as with \"Proof using. Admitted\".\nI also tried \"Proof using. admit. Qed\". Same results.\n\nFor further debugging:\n- git clone git+ssh://arthurc@ scm.gforge.inria.fr//gitroot/tlc/tlc.git\n- checkout the branch: coqdebug\n- if coq v8.5 not in path: create a file \"settings.sh\" with contents e.g. \"COQBIN=~/softs/coq/bin/\"\n- run \"make quick\" (for vio files) then \"make proof_vo\" (for vo files).\n- run script \"removeproof.sh\" which updates files in place.\n- \"make clean\", and \"make again\", to see the smaller vio files.\n\n\nHope this helps,\n+\nArthur\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532842","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532842","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532842,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg0Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T14:18:49Z","updated_at":"2017-10-18T09:56:41Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nThanks for the git (and all the memories installing php5-cli brought back to me :-).\n\nI can't reproduce the odd behavior.  Here the size of .vio files\nis pretty invariant on the actual proof scripts they contain.\n\nSure, .vio files are big (is seems tha base is 17M, then each file adds on top of it a little).  I don't know how PMP manages to read the .vio with votour, I can't undestand if the big part is the module_signature or not. :-/\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532843","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532843","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532843,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg0Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T14:52:55Z","updated_at":"2017-10-18T09:56:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n\n> Thanks for the git (and all the memories installing php5-cli brought back to\n> me :-).\n\nI can't install it on the machine I have here (not root). Can you give us the resulting proofs on a distinct git branch?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532848","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532848","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532848,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg0OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T15:48:04Z","updated_at":"2017-10-18T09:56:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nIn any case, same symptom for TLC as for Bedrock: vm code in module types eats up space. Just to highlight it out, some functor-intensive proofs in the stdlib already account for a lot of eaten up memory. For instance, I often stumble upon the module NLog.NLog2Prop, whose expanded type feature a lot of vm compiled code.\n\nWhy on earth module signatures in functors embed compiled code for the vm???\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532851","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532851","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532851,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg1MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T15:51:00Z","updated_at":"2017-10-18T09:56:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nNot 100% sure, but at some point Bruno told me that even if something is called module_signature in kernel/ it may be used to store the module_body.  So maybe you are looking at the body of the module/functor.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532852","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532852","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532852,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg1Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T15:57:22Z","updated_at":"2017-10-18T09:56:42Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n\n> Not 100% sure, but at some point Bruno told me that even if something is\n> called module_signature in kernel/ it may be used to store the module_body. \n> So maybe you are looking at the body of the module/functor.\n\nNo, this is not the case. Here is a snippet of the corresponding functor:\n\nModule Type\n NLog.NLog2Prop =\n Funsig (A:NAxioms.NAxiomsSig)\n   Funsig\n     (B:Sig\n          Definition eq_refl : RelationClasses.Reflexive A.eq.\n          ...\n        End)\n     Funsig\n       (C:Sig ... End)\n     Funsig (D:Sig ... End)\n         Sig\n           ...\n         End\n\nThen eq_refl is only a term in the signature of the argument of the functor, and nonetheless it has a huge cemitcode. Fully printing the contents of the functor gives an idea of how huge this is (and thus the measure of the memory leak). It seems that this size is due to unapplied module substitution, so maybe we should flush this out before marshalling?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532854","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532854","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532854,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg1NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:02:21Z","updated_at":"2017-10-18T09:56:43Z","author_association":"CONTRIBUTOR","body":"Comment author: @charguer\n\nI have been a bit confused by two versions of Coq that I had, and I give all results below. (One month ago, you could get smaller vio files).\nThe point remains: a factor 200 in size for the vio vs the vo\n(even for a file with mostly tactics inside).\n\n\nI put my files in two branches of TLC: coqdebug_withproofs coqdebug_withoutproofs (hopefully I got this right)\nRun \"make LibEqual.vo\" to reproduce results below.\n\n\n======== branch coqdebug_withproofs, coq from March 19th\n\nls -all LibEqual.{vio,vo} LibTactics.{vio,vo}\n-rw-rw-r-- 1 charguer charguer 17971459 mars  25 16:51 LibEqual.vio\n-rw-rw-r-- 1 charguer charguer   100097 mars  25 16:51 LibEqual.vo\n-rw-rw-r-- 1 charguer charguer 18444376 mars  25 16:51 LibTactics.vio\n-rw-rw-r-- 1 charguer charguer   457296 mars  25 16:51 LibTactics.vo\n\n======== branch coqdebug_withoutproofs, coq from March 19th\n\nls -all LibEqual.{vio,vo} LibTactics.{vio,vo}\n-rw-rw-r-- 1 charguer charguer 17931740 mars  25 16:50 LibEqual.vio\n-rw-rw-r-- 1 charguer charguer    70068 mars  25 16:50 LibEqual.vo\n-rw-rw-r-- 1 charguer charguer 18434965 mars  25 16:50 LibTactics.vio\n-rw-rw-r-- 1 charguer charguer   446980 mars  25 16:50 LibTactics.vo\n\n======== branch coqdebug_withproofs, coq from Feb 17th\n\n\nls -all LibEqual.{vio,vo} LibTactics.{vio,vo}\n-rw-rw-r-- 1 charguer charguer 17992494 mars  25 16:52 LibEqual.vio\n-rw-rw-r-- 1 charguer charguer    99956 mars  25 16:52 LibEqual.vo\n-rw-rw-r-- 1 charguer charguer 18569124 mars  25 16:52 LibTactics.vio\n-rw-rw-r-- 1 charguer charguer   457102 mars  25 16:52 LibTactics.vo\n\n======== branch coqdebug_withoutproofs, coq from Feb 17th \n======> small vio files!\n\nmake LibEqual.vo\nls -all LibTactics.{vio,vo} LibEqual.{vio,vo}\n-rw-rw-r-- 1 charguer charguer 69948 mars  25 16:45 LibEqual.vio\n-rw-rw-r-- 1 charguer charguer 69927 mars  25 16:48 LibEqual.vo\n-rw-rw-r-- 1 charguer charguer 446808 mars  25 16:45 LibTactics.vio\n-rw-rw-r-- 1 charguer charguer 446788 mars  25 16:48 LibTactics.vo\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532855","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532855","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532855,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg1NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:03:48Z","updated_at":"2017-10-18T09:56:43Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI know that I am abusing your kindness, but could you try to run a git bisect?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532855/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532859","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532859","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532859,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg1OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:13:03Z","updated_at":"2017-10-18T09:56:43Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nPMP: I've no idea whatsoever.  If you want to try you could experiment by changing the freeze function and perform this \"compaction\" when the argument says we are freezing to marshal.  Surely Pierre L. knows better these module substs.\n\nArthur: thanks! The patch that makes \"Admitted\" proofs processed asynchronously dates 9/3/2015, so the coq from february is not storing tasks for them (i.e. the .vio are exactly the .vo).  Cfr: https://coq.inria.fr/bugs/show_bug.cgi?id=4032\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532859/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532860","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532860","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532860,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:13:28Z","updated_at":"2017-10-18T09:56:43Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nRace condition: no need to bisect.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532861","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532861","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532861,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:16:06Z","updated_at":"2017-10-18T09:56:44Z","author_association":"CONTRIBUTOR","body":"Comment author: @charguer\n\nOk, so, if I understand well, there is no \"oddity\" anymore of smaller vio files; however there still is a factor 200 to fix somehow.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532864","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532864","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532864,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:23:21Z","updated_at":"2017-10-18T09:56:44Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\nI am trying a patch for a more clever module substitution for VM code. I'll keep you in touch.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532865","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532865","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532865,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T16:25:01Z","updated_at":"2017-10-18T09:56:44Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nExactly that, Arthur.\n\nI'm not very motivated, but PMP seems to love this challenge, so there is some hope :-)\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532867","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532867","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532867,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T10:48:12Z","updated_at":"2017-10-18T09:56:44Z","author_association":"CONTRIBUTOR","body":"Comment author: @charguer\n\nHi,\n\nIt seems no clear to me whether I should hope for an improvement of the size of the vio files by a factor 200, while sticking to the current approach, in time before the v8.5 release.\n\nWhile this problem is not solved, would it not make sense to propose another kind of file, call it \"*.voi\" (unlike \"*.vio\") that would simply contain what the *.vo file contains if it were produced by ignoring text between \"Proof using\" and \"Qed/Admitted\"? \n\nI know there would be overhead to having to introduce another extension and to duplicate the -quick option, but at least we could obtain, for sure, a working system that enables fast recompilation of libraries, without any memory overhead.\n\nThoughts?\n\n+\nArthur\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532868","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532868","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532868,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T11:25:43Z","updated_at":"2017-10-18T09:56:45Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nIt is surely doable, but I would not call the file differently (-vio2vo would fail on that kind of .vio).\n\nNow that I think about it, it could be possible with a small effort to store the entire document leading to the proof (in place of the proof fragment + the initial state).\nThis would make things less efficient (if many definitions come before the proof for example) but surely more compact.  In this optic, there would be an extra flag for -quick.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532869","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532869","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532869,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg2OQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T11:51:48Z","updated_at":"2017-10-18T09:56:45Z","author_association":"CONTRIBUTOR","body":"Comment author: @charguer\n\n> it could be possible with a small effort to store the entire document leading to the proof.\n\nI agree this can be done with small effort, but I'd worry about any solution that has non-linear complexity; eventually, we will encounter applications where the scalability issue will bite us.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532871","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532871","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532871,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg3MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T11:57:03Z","updated_at":"2017-10-18T09:56:45Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n> I'd worry about any solution that has non-linear complexity\n\nThe linear size of vio files is inherent to the way we build them. I have thought of several workarounds to counter this.\n\n1. Pack all vio files in a via (or whatever) library file, ensuring sharing between object code. This would require a server compiling vio files and making the whole environment grow, and them write it out at once. This is far out of my reach, and even if Enrico would dedicate a full-time development on this, I highly doubt we would make it for the release.\n\n2. Trick the global environment summary, by dropping the shared part of the environment and reloading it on demand. This may be easier to do, but has a very strong hack smell.\n\nIn short: this is damn complicated...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532873","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532873","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532873,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg3Mw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T12:17:39Z","updated_at":"2017-10-18T09:56:45Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nPMP, do you say \"environment\" as in Global.env?  Because at some point you were pointing the finger to the libstack.  Is it loaded on demand now?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532875","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532875","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532875,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg3NQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T12:30:32Z","updated_at":"2017-10-18T09:56:45Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n> PMP, do you say \"environment\" as in Global.env?  Because at some point you\n> were pointing the finger to the libstack.  Is it loaded on demand now?\n\nNot yet for the libstack. The patch is here, but I am still a bit afraid to push it.\n\nWhen I say environment, I am indeed talking about the summary that contains the Global.env, because it is the one that eats up most of the memory (between 60 and 80%, from my experiments). But actually, its contents are rather stupid, because they essentially come from the others vios and vos. We should be able to reload them on the fly too...\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532876","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532876","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532876,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg3Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T12:40:57Z","updated_at":"2017-10-18T09:56:46Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\nDo we agree it is not an space issue for .vio files only but is a more general problem of Coq's memory usage?  I mean, building the summary.env on the fly (lazily, on demand, whatever) would benefit Coq in general.  Or I'm mistaken?\n\nNo idea if that is possible given the current way of building it (replaying a list of additions to an existing env).  For example, are the libstack node(s?) needed in order to add to the evn an entry named accordingly (so that one could filter + add, rather than just add)?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532878","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532878","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532878,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg3OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T18:06:40Z","updated_at":"2017-10-18T09:56:46Z","author_association":"CONTRIBUTOR","body":"Comment author: @ppedrot\n\n> Do we agree it is not an space issue for .vio files only but is a more\n> general problem of Coq's memory usage?\n\nNot only. There is also a lot of duplication between .vio files, because they embed the whole session that lead to them. Typically, assuming a dependency chain of the form A -> B -> C, C.vio will somehow contain all the data from B.vio, while it could only retrieve it from B.vio. This is the linear issue I was talking about, that leads to a quadratic blowup.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532882","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532882","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532882,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg4Mg==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T07:45:52Z","updated_at":"2017-10-18T09:56:46Z","author_association":"CONTRIBUTOR","body":"Comment author: @RalfJung\n\nIn case another example for a development with large vio files is useful, you could check out <https://gitlab.mpi-sws.org/FP/iris-coq.git>.  \"make quick\" only works with Coq 8.6 here, take for example commit 1bc26dc9822d6595df8d134fe365dd0356a4ac0b.  The .vo files sum up to 20MB, the .vio files sum up to roughly 2GB (factor 100).\n\nIn particular the quadratic dependency on the number of files is hitting us really hard; we like to split things into many files so that \"make -jX\" is more parallel.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532884","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532884","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532884,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg4NA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T08:01:33Z","updated_at":"2017-10-18T09:56:46Z","author_association":"CONTRIBUTOR","body":"Comment author: @RalfJung\n\nOh, just to clarify:  There is not much potential for actual parallelism currently.  We use many sections and haven't yet adopted \"Proof using\", so \"make quick\" takes almost as long as \"make\".  I am not sure whether that will have an effect on the vio file size.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532886","html_url":"https://github.com/coq/coq/issues/4123#issuecomment-337532886","issue_url":"https://api.github.com/repos/coq/coq/issues/4123","id":337532886,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUzMjg4Ng==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2017-06-02T17:14:46Z","updated_at":"2017-10-18T09:56:47Z","author_association":"CONTRIBUTOR","body":"Comment author: @ejgallego\n\nI am not sure I got all the details here but why is not the right solution here to store in the .vio file only the diff between two consecutive summaries?\n\n[I am aiming to build summary diff for 8.8 as to improve a bit worker load]\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337532886/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]