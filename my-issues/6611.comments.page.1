[{"url":"https://api.github.com/repos/coq/coq/issues/comments/358794245","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-358794245","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":358794245,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODc5NDI0NQ==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-01-18T21:54:38Z","updated_at":"2018-01-18T21:54:38Z","author_association":"MEMBER","body":"It looks like more and more time is passed in the OCaml compiler function `Lambda.free`.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/358794245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/358795683","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-358795683","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":358795683,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODc5NTY4Mw==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-01-18T21:59:54Z","updated_at":"2018-01-18T21:59:54Z","author_association":"MEMBER","body":"But wait, your terms are growing bigger, so it's expected that compilation time increases. And resetting it doesn't change anything for me. Am I missing something?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/358795683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/358795755","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-358795755","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":358795755,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODc5NTc1NQ==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-01-18T22:00:09Z","updated_at":"2018-01-18T22:00:09Z","author_association":"MEMBER","body":"@ppedrot Note that at each successive iteration, the term that I pass has (at least) one more binder / lambda term.  Does the additional time spent in `Lambda.free` come from this, or is it the thing that goes down when you restart Coq?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/358795755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/358819959","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-358819959","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":358819959,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODgxOTk1OQ==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-01-18T23:46:14Z","updated_at":"2018-01-18T23:46:14Z","author_association":"MEMBER","body":"@ppedrot You can't reproduce the effect that I saw if you run the two files in sequence?  The end of the first file has:\r\n```\r\nnative timing n= 785\r\nTactic call ran for 1.094 secs (0.039u,0.004s) (success)\r\nnative timing n= 790\r\nTactic call ran for 1.083 secs (0.035u,0.004s) (success)\r\nnative timing n= 795\r\nTactic call ran for 1.114 secs (0.044u,0.004s) (success)\r\nnative timing n= 800\r\nTactic call ran for 1.104 secs (0.039u,0.004s) (success)\r\n```\r\nand the beginning of the second is\r\n```\r\nnative timing n= 805\r\nTactic call ran for 1.082 secs (0.012u,0.008s) (success)\r\nnative timing n= 810\r\nTactic call ran for 1.084 secs (0.012u,0.008s) (success)\r\nnative timing n= 815\r\nTactic call ran for 1.094 secs (0.016u,0.003s) (success)\r\nnative timing n= 820\r\nTactic call ran for 1.096 secs (0.02u,0.s) (success)\r\n```\r\nNote that the user time is about 4x faster between the end of the first and the beginning of the second, and the real time is consistently about 2% faster.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/358819959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/358825037","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-358825037","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":358825037,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODgyNTAzNw==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-01-19T00:12:23Z","updated_at":"2018-01-19T00:12:23Z","author_association":"MEMBER","body":"@ppedrot Here is one that demonstrates the issue with decreasing term size:\r\n```coq\r\nFixpoint expr_of_nat {var} (n : nat) : @expr var\r\n  := match n with\r\n     | O => NatO\r\n     | S n => NatS (expr_of_nat n)\r\n     end.\r\n\r\nDefinition tests3\r\n  := List.map (fun n => (fun var => @big' var (expr_of_nat n) (count_of_nat 800)))\r\n              (List.rev (List.seq 1 600)).\r\n\r\nLtac foreach1 tac ls :=\r\n  lazymatch ls with\r\n  | nil => idtac\r\n  | cons ?term ?ls\r\n    => tac term; foreach1 tac ls\r\n  end.\r\n\r\nLtac test_one_native3 term :=\r\n  time try (let k := (eval native_compute in term) in fail);\r\n  idtac.\r\n\r\nLtac test_native_3 :=\r\n  let tests := tests3 in\r\n  let ls := (eval lazy in tests) in\r\n  let ls := (eval vm_compute in tests) in\r\n  foreach1 test_one_native3 ls.\r\n```\r\n\r\nIt gives this graph of user time vs iteration:\r\n![user time vs iteration](https://user-images.githubusercontent.com/396076/35128104-dfc42a6e-fc82-11e7-9f82-413401ef0d99.png)\r\n\r\nThere is a slow but definite increase in user-time, even as term size decreases (slightly).\r\n\r\nBy contrast, the real time is kind-of all over the place:\r\n![real time vs iteration](https://user-images.githubusercontent.com/396076/35128216-64875e2e-fc83-11e7-9c1b-e573c98be972.png)\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/358825037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405930556","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405930556","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405930556,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTkzMDU1Ng==","user":{"login":"maximedenes","id":647105,"node_id":"MDQ6VXNlcjY0NzEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/647105?v=4","gravatar_id":"","url":"https://api.github.com/users/maximedenes","html_url":"https://github.com/maximedenes","followers_url":"https://api.github.com/users/maximedenes/followers","following_url":"https://api.github.com/users/maximedenes/following{/other_user}","gists_url":"https://api.github.com/users/maximedenes/gists{/gist_id}","starred_url":"https://api.github.com/users/maximedenes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maximedenes/subscriptions","organizations_url":"https://api.github.com/users/maximedenes/orgs","repos_url":"https://api.github.com/users/maximedenes/repos","events_url":"https://api.github.com/users/maximedenes/events{/privacy}","received_events_url":"https://api.github.com/users/maximedenes/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T13:28:18Z","updated_at":"2018-07-18T13:28:18Z","author_association":"MEMBER","body":"@JasonGross did you manage to reach significant user time (say 10s) ?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405930556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405980706","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405980706","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405980706,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTk4MDcwNg==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T15:51:48Z","updated_at":"2018-07-18T15:51:48Z","author_association":"MEMBER","body":"@maximedenes That is a big demand.  I am running `native_compute` as the identity function on terms here, and the real time is 100x the user time.  So to make 10s user time, I'd have to wait 15 minutes for each individual call to `native_compute`.  Unless you're asking that I continue running it until the user-time hits 10s, which would take at least a couple of hours, and might stack-overflow on `nat`s being too big...","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405980706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984111","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405984111","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405984111,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTk4NDExMQ==","user":{"login":"maximedenes","id":647105,"node_id":"MDQ6VXNlcjY0NzEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/647105?v=4","gravatar_id":"","url":"https://api.github.com/users/maximedenes","html_url":"https://github.com/maximedenes","followers_url":"https://api.github.com/users/maximedenes/followers","following_url":"https://api.github.com/users/maximedenes/following{/other_user}","gists_url":"https://api.github.com/users/maximedenes/gists{/gist_id}","starred_url":"https://api.github.com/users/maximedenes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maximedenes/subscriptions","organizations_url":"https://api.github.com/users/maximedenes/orgs","repos_url":"https://api.github.com/users/maximedenes/repos","events_url":"https://api.github.com/users/maximedenes/events{/privacy}","received_events_url":"https://api.github.com/users/maximedenes/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T16:01:22Z","updated_at":"2018-07-18T16:01:22Z","author_association":"MEMBER","body":"> Unless you're asking that I continue running it until the user-time hits 10s, which would take at least a couple of hours, and might stack-overflow on nats being too big...\r\n\r\nYeah no, I don't mean to torture you :) I was wondering if we could somehow observe timings that would be significant enough to eliminate GC cycles as a potential source of the problem.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984582","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405984582","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405984582,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTk4NDU4Mg==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T16:02:43Z","updated_at":"2018-07-18T16:02:43Z","author_association":"MEMBER","body":"Is there a tactic that invokes the GC?  If there is one (or if you hand me one), I can invoke that between every call to `native_compute`.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984582/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984701","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405984701","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405984701,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTk4NDcwMQ==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T16:03:07Z","updated_at":"2018-07-18T16:03:07Z","author_association":"MEMBER","body":"Or do you mean something else by \"GC cycles\"?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405984701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/405985821","html_url":"https://github.com/coq/coq/issues/6611#issuecomment-405985821","issue_url":"https://api.github.com/repos/coq/coq/issues/6611","id":405985821,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTk4NTgyMQ==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-07-18T16:05:42Z","updated_at":"2018-07-18T16:05:42Z","author_association":"MEMBER","body":"Note that https://github.com/coq/coq/issues/8092 is a big headache in trying to get accurate timing data here.  I jump through hoops to avoid every native_compiling identical terms in this example, because I'm not sure exactly where the cache shows up","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/405985821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]