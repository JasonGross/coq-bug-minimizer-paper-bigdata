[{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520477","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-337520477","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":337520477,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMDQ3Nw==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-06-19T10:53:25Z","updated_at":"2017-10-18T09:21:01Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nThe strategy command should allow more notions of opacity, which I've given tentative names to below:\n\nopaque_irrelevant - the constant is treated as not convertible with its body by the kernel and all reduction machinery\n\nopaque_un_unfoldable - the constant is treated as convertible with its body by the kernel, but no reduction machinery will unfold it, and [unfold qualid] will fail\n\nopaque_unfoldable - the constant is treated as convertible with its body by the kernel, and [unfold qualid] will succeed, but no reduction machinery will unfold it unless it is explicitly mentioned in the list of qualids passed to delta\n\nopaque_autounfoldable - acts as +∞ - the constant is treated as convertible with its body by the kernel, [unfold qualid] will succeed, and reduction machinery will only unfold it after every term of a lower level has been unfolded\n\n\nexpand - as currently used (behaves as -∞)\n\nexpand_invisible - this term should not appear in the body or type of any definition passed to the kernel; as soon as it is encountered, it is unfolded and beta-reduction is performed on the head of the term until it cannot be beta-reduced further.  The purpose would be to, e.g., declare coercions that are invisible to the resulting term (don't interfere with pattern matching), or typeclass machinery that disappears after it is inferred.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520478","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-337520478","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":337520478,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMDQ3OA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-06-19T19:46:40Z","updated_at":"2017-10-18T09:21:01Z","author_association":"CONTRIBUTOR","body":"Comment author: @gares\n\n> opaque_un_unfoldable - the constant is treated as convertible with its body by \n> the kernel, but no reduction machinery will unfold it, and [unfold qualid] \n> will fail\n\nThis makes no sense to me.  What do you mean by \"no reduction machinery\"?\nThe kernel \"conversion\" test is entangled with \"reduction\", actually it\nuses the \"lazy\" one.\n\nImage f defined as fun x y => x + y, now the kernel would consider\n  f = fun x y => x + y\nbut not\n  f 1 2 = 1 + 2\non the contrary\n  f 1 2 = (fun x y => x + y) 1 2\n\nThis breaks all the nice properties of reduction/conversion, at least If you\ninterpret your request literally.\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520480","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-337520480","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":337520480,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMDQ4MA==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-06-19T19:53:34Z","updated_at":"2017-10-18T09:21:01Z","author_association":"CONTRIBUTOR","body":"Comment author: @JasonGross\n\nSorry for the confused description.  I meant for [opaque_un_unfoldable] to correspond to what is currently given by [Opaque]:\n\n\"\"\"\nThe command tells not to unfold the constants qualid1 … qualidn in tactics using δ-conversion (unfolding a constant is replacing it by its definition).\n\nOpaque has also on effect on the conversion algorithm of Coq, telling to delay the unfolding of a constant as later as possible in case Coq has to check the conversion (see Section 4.3) of two distinct applied constants.\n\"\"\"\n\n(Also, if the reference manual still reads like this, \"telling to delay\" should be replaced by \"telling it to delay\" and \"as later as possible in case\" should be replaced by \"as much as possible when\" (grammar).)\n\n\nDoes the description I gave make sense (and mean what [opaque] does above) if you replace \"reduction machinery\" with \"tactics\"?\n\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520480/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520481","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-337520481","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":337520481,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzUyMDQ4MQ==","user":{"login":"coqbot","id":13040781,"node_id":"MDQ6VXNlcjEzMDQwNzgx","avatar_url":"https://avatars.githubusercontent.com/u/13040781?v=4","gravatar_id":"","url":"https://api.github.com/users/coqbot","html_url":"https://github.com/coqbot","followers_url":"https://api.github.com/users/coqbot/followers","following_url":"https://api.github.com/users/coqbot/following{/other_user}","gists_url":"https://api.github.com/users/coqbot/gists{/gist_id}","starred_url":"https://api.github.com/users/coqbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coqbot/subscriptions","organizations_url":"https://api.github.com/users/coqbot/orgs","repos_url":"https://api.github.com/users/coqbot/repos","events_url":"https://api.github.com/users/coqbot/events{/privacy}","received_events_url":"https://api.github.com/users/coqbot/received_events","type":"User","site_admin":false},"created_at":"2014-08-14T13:49:13Z","updated_at":"2020-02-21T16:19:27Z","author_association":"CONTRIBUTOR","body":"Comment author: @mattam82\r\n\r\n*** #2074 has been marked as a duplicate of this bug. ***\r\n\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/337520481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/349547910","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-349547910","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":349547910,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTU0NzkxMA==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2017-12-06T06:28:05Z","updated_at":"2017-12-06T06:28:05Z","author_association":"MEMBER","body":"I'd like to have a tactical `with_constants_as_truely_opaque [ident_list] tac` which executes `tac ()` in a context where the kernel is forbidden from unfolding any of the identifiers in `ident_list` for any reason whatsoever.  This would let me work around bugs in canonical structure resolution / bugs in unification such as https://github.com/coq/coq/issues/6327.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/349547910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/589755567","html_url":"https://github.com/coq/coq/issues/3389#issuecomment-589755567","issue_url":"https://api.github.com/repos/coq/coq/issues/3389","id":589755567,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTc1NTU2Nw==","user":{"login":"Blaisorblade","id":289960,"node_id":"MDQ6VXNlcjI4OTk2MA==","avatar_url":"https://avatars.githubusercontent.com/u/289960?v=4","gravatar_id":"","url":"https://api.github.com/users/Blaisorblade","html_url":"https://github.com/Blaisorblade","followers_url":"https://api.github.com/users/Blaisorblade/followers","following_url":"https://api.github.com/users/Blaisorblade/following{/other_user}","gists_url":"https://api.github.com/users/Blaisorblade/gists{/gist_id}","starred_url":"https://api.github.com/users/Blaisorblade/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Blaisorblade/subscriptions","organizations_url":"https://api.github.com/users/Blaisorblade/orgs","repos_url":"https://api.github.com/users/Blaisorblade/repos","events_url":"https://api.github.com/users/Blaisorblade/events{/privacy}","received_events_url":"https://api.github.com/users/Blaisorblade/received_events","type":"User","site_admin":false},"created_at":"2020-02-21T17:34:43Z","updated_at":"2020-02-21T17:34:43Z","author_association":"CONTRIBUTOR","body":"@JasonGross I guess `with_constants_as_truely_opaque` should use `opaque_un_unfoldable` and not `opaque_irrelevant`, so it should be named `with_constants_as_opaque_un_unfoldable`. \r\n\r\nMaybe that's obvious, but `opaque_irrelevant` breaks subject reduction:\r\n```coq\r\nSection foo.\r\nContext (A: Type) (a: A).\r\nDefinition B: Type := A.\r\nDefinition b: B := a.\r\nLemma eq_ab : a = b. Proof. easy. Qed.\r\n\r\n...\r\nwith_constants_as_truely_opaque [b B] (fun () ⇒ exact eq_ab).\r\n```\r\n\r\nFor the same reason, terms can never *become* `opaque_irrelevant`, they can only be born as such — via `Qed.` or similar future mechanisms.\r\nLetting `opaque_irrelevant` terms become less opaque would be safe, but it'd violate abstraction guarantees.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/589755567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]