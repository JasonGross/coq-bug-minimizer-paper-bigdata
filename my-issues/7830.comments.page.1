[{"url":"https://api.github.com/repos/coq/coq/issues/comments/397671145","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397671145","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397671145,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzY3MTE0NQ==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T16:16:39Z","updated_at":"2018-06-15T16:16:39Z","author_association":"MEMBER","body":"Problem stems from the optimization function `Mlutil.simpl`, that reallocates huge subterms in your case. I'll check whether trying to preserve sharing helps in any way.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397671145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397672596","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397672596","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397672596,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzY3MjU5Ng==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T16:22:25Z","updated_at":"2018-06-15T16:22:25Z","author_association":"MEMBER","body":"As a workaround, your examples go through with `Unset Extraction Optimize`.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397672596/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397673835","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397673835","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397673835,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzY3MzgzNQ==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T16:26:34Z","updated_at":"2018-06-15T16:26:34Z","author_association":"MEMBER","body":"Even more precisely, unsetting the flag corresponding to `opt_case_iot` (4) is enough.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397673835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397790576","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397790576","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397790576,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Nzc5MDU3Ng==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T06:18:53Z","updated_at":"2018-06-16T06:18:53Z","author_association":"MEMBER","body":"Thanks, `Unset Extraction Optimize` works for my case!  What's the optimization function trying to do?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397790576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397800523","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397800523","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397800523,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzgwMDUyMw==","user":{"login":"ppedrot","id":1202327,"node_id":"MDQ6VXNlcjEyMDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/1202327?v=4","gravatar_id":"","url":"https://api.github.com/users/ppedrot","html_url":"https://github.com/ppedrot","followers_url":"https://api.github.com/users/ppedrot/followers","following_url":"https://api.github.com/users/ppedrot/following{/other_user}","gists_url":"https://api.github.com/users/ppedrot/gists{/gist_id}","starred_url":"https://api.github.com/users/ppedrot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppedrot/subscriptions","organizations_url":"https://api.github.com/users/ppedrot/orgs","repos_url":"https://api.github.com/users/ppedrot/repos","events_url":"https://api.github.com/users/ppedrot/events{/privacy}","received_events_url":"https://api.github.com/users/ppedrot/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T09:31:30Z","updated_at":"2018-06-16T09:31:30Z","author_association":"MEMBER","body":"The problem comes from applying the following rule, rewriting:\r\n```\r\nmatch\r\n  match n with\r\n  | X => A\r\n  | Y => B\r\n  end\r\nwith\r\n| A => t\r\n| B => u\r\nend\r\n```\r\ninto\r\n```\r\nmatch n with\r\n| X => t\r\n| Y => u\r\nend\r\n```\r\nI suspect that in some cases it generates intermediate exponentially bigger terms, but I didn't manage to reproduce it on a simple example.\r\n","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397800523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397817251","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397817251","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397817251,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzgxNzI1MQ==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T14:49:37Z","updated_at":"2018-06-16T14:53:20Z","author_association":"MEMBER","body":"Ah, that would do it.  I deliberately chose the first representation because the second representation was too slow in reduction.  Does it reproduce if you have:\r\n```coq\r\nFixpoint u (k : nat) (n : T) :=\r\n match\r\n  match n with\r\n  | X => true\r\n  | _ => false\r\n  end\r\nwith\r\n| true => 0\r\n| false => match k with 0 => 0 | S k => u k n end\r\nend.\r\nDefinition careful := Compute fun n => u 200 n.\r\n```\r\nwith `T` an inductive type with a hundred constructors, and look at extracting `careful`?","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397817251/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397817587","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397817587","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397817587,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzgxNzU4Nw==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T14:55:48Z","updated_at":"2018-06-16T14:55:48Z","author_association":"MEMBER","body":"Also, I find it amusing that the code the extractor is having trouble with is code that I got out of reducing a pattern matching compilation routine I implemented.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397817587/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/397828298","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-397828298","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":397828298,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzgyODI5OA==","user":{"login":"JasonGross","id":396076,"node_id":"MDQ6VXNlcjM5NjA3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/396076?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonGross","html_url":"https://github.com/JasonGross","followers_url":"https://api.github.com/users/JasonGross/followers","following_url":"https://api.github.com/users/JasonGross/following{/other_user}","gists_url":"https://api.github.com/users/JasonGross/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonGross/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonGross/subscriptions","organizations_url":"https://api.github.com/users/JasonGross/orgs","repos_url":"https://api.github.com/users/JasonGross/repos","events_url":"https://api.github.com/users/JasonGross/events{/privacy}","received_events_url":"https://api.github.com/users/JasonGross/received_events","type":"User","site_admin":false},"created_at":"2018-06-16T17:42:12Z","updated_at":"2018-06-16T17:42:12Z","author_association":"MEMBER","body":"Here is an example were `Extraction` blows up \r\n\r\n```coq\r\nRequire Import Coq.extraction.Extraction.\r\nRequire Import Coq.extraction.ExtrOcamlBasic.\r\nExtraction Language OCaml.\r\n\r\nInductive T : Set :=\r\n| X\r\n| X0| X1| X2| X3| X4| X5| X6| X7| X8| X9| X10| X11| X12| X13| X14| X15| X16| X17| X18| X19\r\n| X20| X21| X22| X23| X24| X25| X26| X27| X28| X29| X30| X31| X32| X33| X34| X35| X36| X37| X38| X39\r\n| X40| X41| X42| X43| X44| X45| X46| X47| X48| X49| X50| X51| X52| X53| X54| X55| X56| X57| X58| X59\r\n| X60| X61| X62| X63| X64| X65| X66| X67| X68| X69| X70| X71| X72| X73| X74| X75| X76| X77| X78| X79\r\n| X80| X81| X82| X83| X84| X85| X86| X87| X88| X89| X90| X91| X92| X93| X94| X95| X96| X97| X98| X99.\r\nFixpoint u (k : nat) (n : T) :=\r\n  match\r\n    match n with\r\n    | X => (true, X)\r\n    | n' => (false, n')\r\n    end\r\n  with\r\n  | (true, _) => 0\r\n  | (false, _) => match k with 0 => 0 | S k => u k n end\r\n  end.\r\nDefinition careful := Eval cbv in fun n => u 200 n.\r\nUnset Extraction Optimize.\r\nTime Redirect \"/tmp/foo\" Recursive Extraction careful.\r\n(* Finished transaction in 0.481 secs (0.476u,0.004s) (successful) *)\r\nSet Extraction Optimize.\r\nRedirect \"/tmp/foo\" Recursive Extraction careful.\r\n(* blows up *)\r\n```","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/397828298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/coq/coq/issues/comments/592400987","html_url":"https://github.com/coq/coq/issues/7830#issuecomment-592400987","issue_url":"https://api.github.com/repos/coq/coq/issues/7830","id":592400987,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MjQwMDk4Nw==","user":{"login":"pi8027","id":111003,"node_id":"MDQ6VXNlcjExMTAwMw==","avatar_url":"https://avatars.githubusercontent.com/u/111003?v=4","gravatar_id":"","url":"https://api.github.com/users/pi8027","html_url":"https://github.com/pi8027","followers_url":"https://api.github.com/users/pi8027/followers","following_url":"https://api.github.com/users/pi8027/following{/other_user}","gists_url":"https://api.github.com/users/pi8027/gists{/gist_id}","starred_url":"https://api.github.com/users/pi8027/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pi8027/subscriptions","organizations_url":"https://api.github.com/users/pi8027/orgs","repos_url":"https://api.github.com/users/pi8027/repos","events_url":"https://api.github.com/users/pi8027/events{/privacy}","received_events_url":"https://api.github.com/users/pi8027/received_events","type":"User","site_admin":false},"created_at":"2020-02-28T08:14:31Z","updated_at":"2020-02-28T08:14:31Z","author_association":"CONTRIBUTOR","body":"In this particular example, `Set Extraction Flag 1007` (enabling the `opt_lin_let` option) is also a possible workaround, but it does not help us to solve this issue in general.","reactions":{"url":"https://api.github.com/repos/coq/coq/issues/comments/592400987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]