{"id":93108882,"status":"success","stage":"test","name":"ci-iris-lambda-rust","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T15:50:50.858Z","started_at":"2018-08-29T15:50:56.259Z","finished_at":"2018-08-29T17:01:02.426Z","duration":4206.167377,"queued_duration":5.349442,"user":{"id":1362220,"username":"Zimmi48","name":"ThÃ©o Zimmermann","state":"active","avatar_url":"https://secure.gravatar.com/avatar/432865975a442512504a808f2ed09e56?s=80&d=identicon","web_url":"https://gitlab.com/Zimmi48","created_at":"2017-05-30T11:37:33.615Z","bio":"","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93108882","artifacts":[{"file_type":"trace","size":216220,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93043492,"status":"success","stage":"test","name":"ci-math-comp","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T12:53:08.123Z","started_at":"2018-08-29T12:53:08.378Z","finished_at":"2018-08-29T13:42:10.115Z","duration":2941.736873,"queued_duration":0.131298,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93043492","artifacts":[{"file_type":"trace","size":312789,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93036682,"status":"success","stage":"test","name":"validate:base+32bit","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T12:31:44.442Z","started_at":"2018-08-29T12:31:47.108Z","finished_at":"2018-08-29T12:43:15.321Z","duration":688.212585,"queued_duration":2.643727,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93036682","artifacts":[{"file_type":"trace","size":26152,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93036505,"status":"success","stage":"test","name":"validate:base","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T12:31:06.360Z","started_at":"2018-08-29T12:31:06.682Z","finished_at":"2018-08-29T12:41:34.191Z","duration":627.508382,"queued_duration":0.265337,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93036505","artifacts":[{"file_type":"trace","size":26186,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93036067,"status":"success","stage":"test","name":"ci-quickchick","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T12:29:30.109Z","started_at":"2018-08-29T12:29:32.444Z","finished_at":"2018-08-29T12:37:13.465Z","duration":461.020337,"queued_duration":2.312672,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93036067","artifacts":[{"file_type":"trace","size":193111,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93035960,"status":"success","stage":"test","name":"ci-coquelicot","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T12:29:10.736Z","started_at":"2018-08-29T12:29:10.931Z","finished_at":"2018-08-29T12:36:50.293Z","duration":459.361434,"queued_duration":0.165408,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93035960","artifacts":[{"file_type":"trace","size":94441,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025764,"status":"success","stage":"test","name":"ci-vst","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.425Z","started_at":"2018-08-29T12:23:47.381Z","finished_at":"2018-08-29T13:30:12.506Z","duration":3985.124758,"queued_duration":83.702154,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025764","artifacts":[{"file_type":"trace","size":149831,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025763,"status":"success","stage":"test","name":"ci-unimath","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.405Z","started_at":"2018-08-29T12:23:47.029Z","finished_at":"2018-08-29T12:52:07.987Z","duration":1700.958105,"queued_duration":83.249589,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025763","artifacts":[{"file_type":"trace","size":124047,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025762,"status":"success","stage":"test","name":"ci-sf","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.386Z","started_at":"2018-08-29T12:23:46.531Z","finished_at":"2018-08-29T12:29:11.410Z","duration":324.878721,"queued_duration":82.635606,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025762","artifacts":[{"file_type":"trace","size":270225,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025760,"status":"success","stage":"test","name":"ci-pidetop","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.348Z","started_at":"2018-08-29T12:23:45.460Z","finished_at":"2018-08-29T12:27:57.712Z","duration":252.252447,"queued_duration":81.347546,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025760","artifacts":[{"file_type":"trace","size":29533,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025759,"status":"success","stage":"test","name":"ci-mtac2","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.328Z","started_at":"2018-08-29T12:23:44.391Z","finished_at":"2018-08-29T12:29:13.153Z","duration":328.762691,"queued_duration":80.204531,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025759","artifacts":[{"file_type":"trace","size":87679,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025757,"status":"success","stage":"test","name":"ci-ltac2","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.289Z","started_at":"2018-08-29T12:23:36.445Z","finished_at":"2018-08-29T12:27:43.790Z","duration":247.34517,"queued_duration":72.094578,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025757","artifacts":[{"file_type":"trace","size":41629,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025755,"status":"success","stage":"test","name":"ci-hott","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.248Z","started_at":"2018-08-29T12:23:27.827Z","finished_at":"2018-08-29T12:37:34.739Z","duration":846.912121,"queued_duration":63.225989,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025755","artifacts":[{"file_type":"trace","size":66588,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025754,"status":"success","stage":"test","name":"ci-geocoq","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.228Z","started_at":"2018-08-29T12:23:21.653Z","finished_at":"2018-08-29T13:25:52.680Z","duration":3751.027523,"queued_duration":56.899603,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025754","artifacts":[{"file_type":"trace","size":267921,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025753,"status":"success","stage":"test","name":"ci-formal-topology","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.207Z","started_at":"2018-08-29T12:23:20.494Z","finished_at":"2018-08-29T13:04:45.928Z","duration":2485.433145,"queued_duration":55.599905,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025753","artifacts":[{"file_type":"trace","size":564391,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025752,"status":"success","stage":"test","name":"ci-flocq","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.184Z","started_at":"2018-08-29T12:23:20.335Z","finished_at":"2018-08-29T12:41:01.700Z","duration":1061.365633,"queued_duration":55.250539,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025752","artifacts":[{"file_type":"trace","size":619358,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025751,"status":"success","stage":"test","name":"ci-fiat-parsers","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.095Z","started_at":"2018-08-29T12:23:20.291Z","finished_at":"2018-08-29T12:43:07.104Z","duration":1186.81349,"queued_duration":54.972527,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025751","artifacts":[{"file_type":"trace","size":237575,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025749,"status":"success","stage":"test","name":"ci-fiat-crypto-legacy","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.054Z","started_at":"2018-08-29T12:23:20.247Z","finished_at":"2018-08-29T14:32:36.991Z","duration":7756.743857,"queued_duration":54.830125,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025749","artifacts":[{"file_type":"trace","size":644795,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025747,"status":"success","stage":"test","name":"ci-fiat-crypto","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:23.012Z","started_at":"2018-08-29T12:23:20.199Z","finished_at":"2018-08-29T13:04:48.376Z","duration":2488.177163,"queued_duration":54.657543,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025747","artifacts":[{"file_type":"trace","size":604973,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025745,"status":"success","stage":"test","name":"ci-fcsl-pcm","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.975Z","started_at":"2018-08-29T12:23:20.155Z","finished_at":"2018-08-29T12:31:42.908Z","duration":502.752925,"queued_duration":54.521616,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025745","artifacts":[{"file_type":"trace","size":90580,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025744,"status":"success","stage":"test","name":"ci-equations","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.934Z","started_at":"2018-08-29T12:23:20.110Z","finished_at":"2018-08-29T12:37:20.316Z","duration":840.205142,"queued_duration":54.422892,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025744","artifacts":[{"file_type":"trace","size":62437,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025743,"status":"success","stage":"test","name":"ci-elpi","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.894Z","started_at":"2018-08-29T12:23:19.674Z","finished_at":"2018-08-29T12:29:11.737Z","duration":352.062195,"queued_duration":53.904429,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025743","artifacts":[{"file_type":"trace","size":464683,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025742,"status":"success","stage":"test","name":"ci-cross-crypto","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.862Z","started_at":"2018-08-29T12:23:09.598Z","finished_at":"2018-08-29T13:05:14.626Z","duration":2525.028244,"queued_duration":43.774042,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025742","artifacts":[{"file_type":"trace","size":74377,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025740,"status":"success","stage":"test","name":"ci-coq-dpdgraph","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.790Z","started_at":"2018-08-29T12:23:08.977Z","finished_at":"2018-08-29T12:28:42.449Z","duration":333.472049,"queued_duration":43.067317,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025740","artifacts":[{"file_type":"trace","size":40181,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025739,"status":"success","stage":"test","name":"ci-compcert","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.749Z","started_at":"2018-08-29T12:23:08.260Z","finished_at":"2018-08-29T12:53:59.340Z","duration":1851.08033,"queued_duration":42.311961,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025739","artifacts":[{"file_type":"trace","size":1998521,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025738,"status":"success","stage":"test","name":"ci-color","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.711Z","started_at":"2018-08-29T12:23:05.548Z","finished_at":"2018-08-29T12:44:38.038Z","duration":1292.490056,"queued_duration":39.563744,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025738","artifacts":[{"file_type":"trace","size":182924,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025737,"status":"success","stage":"test","name":"ci-bignums","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.672Z","started_at":"2018-08-29T12:23:03.725Z","finished_at":"2018-08-29T12:29:17.789Z","duration":374.064199,"queued_duration":37.672494,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025737","artifacts":[{"file_type":"trace","size":41147,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025736,"status":"success","stage":"test","name":"ci-bedrock2","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.643Z","started_at":"2018-08-29T12:22:45.248Z","finished_at":"2018-08-29T12:46:42.969Z","duration":1437.720101,"queued_duration":19.015154,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025736","artifacts":[{"file_type":"trace","size":99438,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025735,"status":"success","stage":"test","name":"validate:edge+flambda","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.616Z","started_at":"2018-08-29T12:22:45.094Z","finished_at":"2018-08-29T12:32:39.647Z","duration":594.552567,"queued_duration":18.76396,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025735","artifacts":[{"file_type":"trace","size":26369,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025734,"status":"success","stage":"test","name":"validate:edge","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.579Z","started_at":"2018-08-29T12:22:44.947Z","finished_at":"2018-08-29T12:32:35.977Z","duration":591.02979,"queued_duration":18.482571,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025734","artifacts":[{"file_type":"trace","size":25212,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025731,"status":"success","stage":"test","name":"test-suite:edge+flambda","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.461Z","started_at":"2018-08-29T12:22:40.669Z","finished_at":"2018-08-29T12:34:45.465Z","duration":724.796291,"queued_duration":13.968587,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025731","artifacts":[{"file_type":"trace","size":70390,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025730,"status":"success","stage":"test","name":"test-suite:edge","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.420Z","started_at":"2018-08-29T12:22:40.594Z","finished_at":"2018-08-29T12:33:08.735Z","duration":628.140664,"queued_duration":13.834335,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025730","artifacts":[{"file_type":"trace","size":69215,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025729,"status":"success","stage":"test","name":"test-suite:base+32bit","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.381Z","started_at":"2018-08-29T12:22:40.171Z","finished_at":"2018-08-29T12:33:37.987Z","duration":657.816083,"queued_duration":13.38012,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025729","artifacts":[{"file_type":"trace","size":69213,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025728,"status":"success","stage":"test","name":"test-suite:base","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.350Z","started_at":"2018-08-29T12:22:39.623Z","finished_at":"2018-08-29T12:35:14.887Z","duration":755.264362,"queued_duration":12.796024,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025728","artifacts":[{"file_type":"trace","size":70207,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025727,"status":"success","stage":"test","name":"documentation","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.328Z","started_at":"2018-08-29T12:22:39.057Z","finished_at":"2018-08-29T12:30:45.248Z","duration":486.191369,"queued_duration":12.146541,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025727","artifacts":[{"file_type":"trace","size":32340,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025726,"status":"success","stage":"test","name":"pkg:nix","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.305Z","started_at":"2018-08-29T12:22:39.009Z","finished_at":"2018-08-29T12:55:20.466Z","duration":1961.457613,"queued_duration":12.05649,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025726","artifacts":[{"file_type":"trace","size":471038,"filename":"job.log","file_format":null}],"runner":{"id":44949,"description":"shared-runners-manager-4.gitlab.com","ip_address":"13.37.237.197","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":null,"tag_list":[]}
{"id":93025725,"status":"success","stage":"test","name":"windows64","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.268Z","started_at":"2018-08-29T12:22:28.563Z","finished_at":"2018-08-29T13:39:51.548Z","duration":4642.984492,"queued_duration":1.538663,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025725","artifacts":[{"file_type":"trace","size":3882978,"filename":"job.log","file_format":null}],"runner":null,"artifacts_expire_at":"2018-09-05T13:39:10.270Z","tag_list":["windows"]}
{"id":93025724,"status":"success","stage":"build","name":"build:egde:dune","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.233Z","started_at":"2018-08-29T11:54:26.748Z","finished_at":"2018-08-29T12:10:18.945Z","duration":952.196963,"queued_duration":3.151915,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025724","artifacts":[{"file_type":"trace","size":23953,"filename":"job.log","file_format":null}],"runner":{"id":380986,"description":"shared-runners-manager-5.gitlab.com","ip_address":"34.74.209.140","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":"2018-09-05T12:10:04.173Z","tag_list":[]}
{"id":93025723,"status":"success","stage":"build","name":"build:edge+flambda","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.205Z","started_at":"2018-08-29T11:54:25.585Z","finished_at":"2018-08-29T12:22:23.562Z","duration":1677.976905,"queued_duration":1.960669,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025723","artifacts":[{"file_type":"trace","size":239131,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":"2018-09-05T12:22:07.030Z","tag_list":[]}
{"id":93025722,"status":"success","stage":"build","name":"build:edge","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.181Z","started_at":"2018-08-29T11:54:25.474Z","finished_at":"2018-08-29T12:11:59.521Z","duration":1054.046637,"queued_duration":1.787509,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025722","artifacts":[{"file_type":"trace","size":237906,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":"2018-09-05T12:11:51.055Z","tag_list":[]}
{"id":93025721,"status":"success","stage":"build","name":"build:base+32bit","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.155Z","started_at":"2018-08-29T11:54:24.789Z","finished_at":"2018-08-29T12:08:59.239Z","duration":874.450514,"queued_duration":1.08008,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025721","artifacts":[{"file_type":"trace","size":233693,"filename":"job.log","file_format":null}],"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","ip_address":"34.74.239.13","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":"2018-09-05T12:08:48.568Z","tag_list":[]}
{"id":93025720,"status":"success","stage":"build","name":"build:base","ref":"pr-6857","tag":false,"coverage":null,"allow_failure":false,"created_at":"2018-08-29T11:54:22.126Z","started_at":"2018-08-29T11:54:24.673Z","finished_at":"2018-08-29T12:09:45.467Z","duration":920.793995,"queued_duration":0.937165,"user":{"id":2256237,"username":"coqbot","name":"coqbot","state":"active","avatar_url":"https://gitlab.com/uploads/-/system/user/avatar/2256237/avatar.png","web_url":"https://gitlab.com/coqbot","created_at":"2018-04-28T07:53:57.210Z","bio":"Hello, I'm a bot.","location":"","public_email":"","skype":"","linkedin":"","twitter":"","website_url":"","organization":"","job_title":"","pronouns":null,"bot":false,"work_information":null,"followers":0,"following":0,"local_time":null},"commit":{"id":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","short_id":"f46f557b","created_at":"2018-08-29T13:53:34.000+02:00","parent_ids":["13b14f47edb099ec933d697e3467bb886884f113"],"title":"[build] Preliminary support for building Coq with `dune`.","message":"[build] Preliminary support for building Coq with `dune`.\n\n[Dune](https://github.com/ocaml/dune) is a compositional declarative\nbuild system for OCaml. It provides automatic generation of\n`version.ml`, `.merlin`, `META`, `opam`, API documentation; install\nmanagement; easy integration with external libraries, test runners,\nand modular builds.\n\nIn particular, Dune uniformly handles components regardless whether\nthey live in, or out-of-tree. This greatly simplifies cases where a\nplugin [or CoqIde] is checked out in the current working copy but then\ndistributed separately [and vice-versa]. Dune can thus be used as a\nmore flexible `coq_makefile` replacement.\n\nFor now we provide experimental support for a Dune build. In order to\nbuild Coq + the standard library with Dune type:\n\n```\n$ make -f Makefile.dune world\n```\n\nThis PR includes a preliminary, developer-only preview of Dune for\nCoq. There is still ongoing work, see\nhttps://github.com/coq/coq/issues/8052 for tracking status towards\nfull support.\n\n## Technical description.\n\nDune works out of the box with Coq, once we have fixed some modularity\nissues. The main remaining challenge was to support `.vo` files.\n\nAs Dune doesn't support custom build rules yet, to properly build\n`.vo` files we provide a small helper script `tools/coq_dune.ml`. The\nscript will scan the Coq library directories and generate the\ncorresponding rules for `.v -> .vo` and `.ml4 -> .ml` builds. The\nscript uses `coqdep` as to correctly output the dependencies of\n`.v` files. `coq_dune` is akin to `coq_makefile` and should be able to\nbe used to build Coq projects in the future.\n\nDue to this pitfall, the build process has to proceed in three stages:\n1) build `coqdep` and `coq_dune`; 2) generate `dune` files for\n`theories` and `plugins`; 3) perform a regular build with all\ntargets are in scope.\n\n## FAQ\n\n### Why Dune?\n\nCoq has a moderately complex build system and it is not a secret that\nmany developer-hours have been spent fighting with `make`.\n\nIn particular, the current `make`-based system does offer poor support\nto verify that the current build rules and variables are coherent, and\nrequires significant manual, error-prone. Many variables must be\npassed by hand, duplicated, etc... Additionally, our make system\noffers poor integration with now standard OCaml ecosystem tools such\nas `opam`, `ocamlfind` or `odoc`. Another critical point is build\ncompositionality. Coq is rich in 3rd party contributions, and a big\nshortcoming of the current make system is that it cannot be used to\nbuild these projects; requiring us to maintain a custom tool,\n`coq_makefile`, with the corresponding cost.\n\nIn the past, there has been some efforts to migrate Coq to more\nspecialized build systems, however these stalled due to a variety of\nreasons. Dune, is a declarative, OCaml-specific build tool that is on\nthe path to become the standard build system for the OCaml ecosystem.\n\nDune seems to be a good fit for Coq well: it is well-supported, fast,\ncompositional, and designed for large projects.\n\n### Does Dune replace the make-based build system?\n\nThe current, make-based build system is unmodified by this PR and kept\nas the default option. However, Dune has the potential\n\n### Is this PR complete? What does it provide?\n\nThis PR is ready for developer preview and feedback. The build system\nis functional, however, more work is necessary in order to make Dune\nthe default for Coq.\n\nThe main TODOs are tracked at https://github.com/coq/coq/issues/8052\n\nThis PR allows developers to use most of the features of Dune today:\n\n- Modular organization of the codebase; each component is built only\n  against declared dependencies so components are checked for\n  containment more strictly.\n- Hygienic builds; Dune places all artifacts under `_build`.\n- Automatic generation of `.install` files, simplified OPAM workflow.\n- `utop` support, `-opaque` in developer mode, etc...\n- `ml4` files are handled using `coqp5`, a native-code customized\n  camlp5 executable which brings much faster `ml4 -> ml` processing.\n\n### What dependencies does Dune require?\n\nDune doesn't depend on any 3rd party package other than the OCaml compiler.\n\n### Some Benchs:\n\n```\n$ /usr/bin/time make DUNEOPT=\"-j 1000\" -f Makefile.dune states\n59.50user 18.81system 0:29.83elapsed 262%CPU (0avgtext+0avgdata 302996maxresident)k\n0inputs+646632outputs (0major+4893811minor)pagefaults 0swaps\n\n$ /usr/bin/time sh -c \"./configure -local -native-compiler no && make -j states\"\n88.21user 23.65system 0:32.96elapsed 339%CPU (0avgtext+0avgdata 304992maxresident)k\n0inputs+1051680outputs (0major+5300680minor)pagefaults 0swaps\n```\n","author_name":"Emilio Jesus Gallego Arias","author_email":"e+git@x80.org","authored_date":"2018-05-24T03:52:06.000+02:00","committer_name":"Emilio Jesus Gallego Arias","committer_email":"e+git@x80.org","committed_date":"2018-08-29T13:53:34.000+02:00","trailers":{},"web_url":"https://gitlab.com/coq/coq/-/commit/f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2"},"pipeline":{"id":28946259,"iid":2761,"project_id":6138686,"sha":"f46f557bd3f38dbd70ea4eef1f7b9b82c902d3c2","ref":"pr-6857","status":"success","source":"push","created_at":"2018-08-29T11:54:22.114Z","updated_at":"2018-08-29T17:01:02.543Z","web_url":"https://gitlab.com/coq/coq/-/pipelines/28946259"},"web_url":"https://gitlab.com/coq/coq/-/jobs/93025720","artifacts":[{"file_type":"trace","size":278370,"filename":"job.log","file_format":null}],"runner":{"id":44028,"description":"shared-runners-manager-3.gitlab.com","ip_address":"35.196.21.178","active":true,"paused":false,"is_shared":true,"runner_type":"instance_type","name":"gitlab-runner","online":false,"status":"stale"},"artifacts_expire_at":"2018-09-05T12:09:39.310Z","tag_list":[]}
